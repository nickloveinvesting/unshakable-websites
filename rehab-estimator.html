<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix & Flip Rehab Cost Estimator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        // Applying custom brand colors to Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'charcoal': '#121212',
                        'rich-black': '#0A0A0A',
                        'brand-fire-start': '#C84A00',
                        'brand-fire-end': '#FF6A00',
                        'brand-gold-start': '#6A4B0F',
                        'brand-gold-end': '#F2C14E',
                        'slate': {
                            400: '#94a3b8'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212; /* --charcoal */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
        /* Style for disabled number inputs and buttons */
        input[type="number"]:disabled, button:disabled {
            background-color: #2d3748;
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-charcoal text-white">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <img src="https://storage.googleapis.com/msgsndr/zQh0YM3EIsWgcjMDTSSC/media/68a5e3a77d00efbb5c207876.png" alt="Company Logo" class="mx-auto h-16 w-auto mb-6">
            <h1 class="text-4xl md:text-5xl font-extrabold uppercase tracking-tighter text-white">Rehab Cost Estimator</h1>
            <p class="text-slate-400 mt-2 max-w-2xl mx-auto">A direct, authoritative, and value-driven tool to project your fix-and-flip costs instantly.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Side: Inputs & Rehab Items -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Property Details Section -->
                <section id="property-details" class="bg-[#1E1E1E] p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold uppercase tracking-tighter mb-4 border-b border-slate-700 pb-2">Property Details</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <input type="text" id="address" placeholder="Property Address" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-brand-fire-end">
                        <div class="relative">
                            <input type="text" id="zipcode" placeholder="Property Zip Code" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-brand-fire-end" maxlength="5">
                             <p id="metro-display" class="text-xs text-slate-400 mt-1 h-4"></p>
                        </div>
                        <input type="number" id="beds" placeholder="# of Beds" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-brand-fire-end" min="0">
                        <input type="number" id="baths" placeholder="# of Baths" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-brand-fire-end" min="0">
                        <input type="number" id="sqft" placeholder="Square Footage (SqFt)" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-brand-fire-end" min="0">
                    </div>
                </section>

                <!-- Rehab Categories Section -->
                <section id="rehab-items" class="space-y-6">
                    <!-- Categories will be dynamically inserted here -->
                </section>
            </div>

            <!-- Right Side: Cost Summary -->
            <div class="lg:col-span-1 lg:sticky top-8 h-fit">
                <aside class="bg-[#1E1E1E] p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold uppercase tracking-tighter mb-6 border-b border-slate-700 pb-2">Cost Summary</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center bg-slate-800 p-4 rounded-lg">
                            <span class="text-slate-400">Total Base Rehab Cost</span>
                            <span id="total-rehab-cost" class="text-2xl font-bold text-white">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-slate-800 p-4 rounded-lg">
                            <span class="text-slate-400">Metro Area Adjustment</span>
                            <span id="rehab-estimation" class="text-2xl font-bold text-white">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center bg-gradient-to-r from-brand-fire-start to-brand-fire-end text-white p-4 rounded-lg">
                            <span class="font-semibold">Final Estimate (+10%)</span>
                            <span id="final-estimation" class="text-3xl font-bold">$0.00</span>
                        </div>
                    </div>
                     <p class="text-xs text-slate-500 mt-6 text-center">Disclaimer: This tool provides a rough estimate for informational purposes only.</p>
                     <!-- Email Section -->
                     <div class="mt-6 border-t border-slate-700 pt-4">
                        <h3 class="text-lg font-bold uppercase tracking-tighter mb-3 text-center">Get a Detailed Breakdown</h3>
                        <div class="space-y-3">
                            <input type="email" id="user-email" placeholder="Enter your email address" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-brand-gold-end">
                            <button id="email-budget-btn" class="w-full bg-gradient-to-r from-brand-gold-start to-brand-gold-end text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity duration-200">
                                Email Me The Full Rehab Budget
                            </button>
                            <p id="email-status" class="text-xs text-center h-4"></p>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <script>
        // --- DATA ---
        const metroData = [
            { metro: "New York-Newark-Jersey City, NY, NJ, PA", multiplier: 1.252, lat: 40.7128, lon: -74.0060 }, { metro: "Los Angeles-Long Beach-Anaheim, CA", multiplier: 1.233, lat: 34.0522, lon: -118.2437 }, { metro: "Chicago-Naperville-Elgin, IL, IN, WI", multiplier: 1.024, lat: 41.8781, lon: -87.6298 }, { metro: "Dallas-Fort Worth-Arlington, TX", multiplier: 1.005, lat: 32.7767, lon: -96.7970 }, { metro: "Houston-The Woodlands-Sugar Land, TX", multiplier: 0.946, lat: 29.7604, lon: -95.3698 }, { metro: "Miami-Fort Lauderdale-Pompano Beach, FL", multiplier: 1.119, lat: 25.7617, lon: -80.1918 }, { metro: "Philadelphia-Camden-Wilmington, PA, NJ, DE, MD", multiplier: 1.037, lat: 39.9526, lon: -75.1652 }, { metro: "Atlanta-Sandy Springs-Alpharetta, GA", multiplier: 0.957, lat: 33.7490, lon: -84.3880 }, { metro: "Washington-Arlington-Alexandria, DC, VA, MD, WV", multiplier: 1.157, lat: 38.9072, lon: -77.0369 }, { metro: "Boston-Cambridge-Newton, MA, NH", multiplier: 1.137, lat: 42.3601, lon: -71.0589 }, { metro: "Phoenix-Mesa-Chandler, AZ", multiplier: 0.999, lat: 33.4484, lon: -112.0740 }, { metro: "San Francisco-Oakland-Berkeley, CA", multiplier: 1.299, lat: 37.7749, lon: -122.4194 }, { metro: "Riverside-San Bernardino-Ontario, CA", multiplier: 1.096, lat: 34.0560, lon: -117.4050 }, { metro: "Detroit-Warren-Dearborn, MI", multiplier: 0.916, lat: 42.3314, lon: -83.0458 }, { metro: "Seattle-Tacoma-Bellevue, WA", multiplier: 1.168, lat: 47.6062, lon: -122.3321 }, { metro: "Minneapolis-St. Paul-Bloomington, MN, WI", multiplier: 1.006, lat: 44.9778, lon: -93.2650 }, { metro: "San Diego-Chula Vista-Carlsbad, CA", multiplier: 1.168, lat: 32.7157, lon: -117.1611 }, { metro: "Tampa-St. Petersburg-Clearwater, FL", multiplier: 1.002, lat: 27.9641, lon: -82.4524 }, { metro: "Denver-Aurora-Lakewood, CO", multiplier: 1.056, lat: 39.7392, lon: -104.9903 }, { metro: "Baltimore-Columbia-Towson, MD", multiplier: 1.066, lat: 39.2904, lon: -76.6122 }, { metro: "St. Louis, MO, IL", multiplier: 0.89, lat: 38.6270, lon: -90.1994 }, { metro: "Orlando-Kissimmee-Sanford, FL", multiplier: 0.993, lat: 28.5383, lon: -81.3792 }, { metro: "Charlotte-Concord-Gastonia, NC, SC", multiplier: 0.948, lat: 35.2271, lon: -80.8431 }, { metro: "San Antonio-New Braunfels, TX", multiplier: 0.916, lat: 29.4241, lon: -98.4936 }, { metro: "Portland-Vancouver-Hillsboro, OR, WA", multiplier: 1.054, lat: 45.5051, lon: -122.6750 }, { metro: "Sacramento-Roseville-Folsom, CA", multiplier: 1.077, lat: 38.5816, lon: -121.4944 }, { metro: "Pittsburgh, PA", multiplier: 0.914, lat: 40.4406, lon: -79.9959 }, { metro: "Austin-Round Rock-Georgetown, TX", multiplier: 1.011, lat: 30.2672, lon: -97.7431 }, { metro: "Las Vegas-Henderson-Paradise, NV", multiplier: 0.996, lat: 36.1699, lon: -115.1398 }, { metro: "Cincinnati, OH, KY, IN", multiplier: 0.914, lat: 39.1031, lon: -84.5120 }, { metro: "Kansas City, MO, KS", multiplier: 0.93, lat: 39.0997, lon: -94.5786 }, { metro: "Columbus, OH", multiplier: 0.929, lat: 39.9612, lon: -82.9988 }, { metro: "Cleveland-Elyria, OH", multiplier: 0.912, lat: 41.4993, lon: -81.6944 }, { metro: "Indianapolis-Carmel-Anderson, IN", multiplier: 0.903, lat: 39.7684, lon: -86.1581 }, { metro: "San Jose-Sunnyvale-Santa Clara, CA", multiplier: 1.303, lat: 37.3382, lon: -121.8863 }, { metro: "Nashville-Davidson--Murfreesboro--Franklin, TN", multiplier: 0.958, lat: 36.1627, lon: -86.7816 }, { metro: "Virginia Beach-Norfolk-Newport News, VA, NC", multiplier: 0.97, lat: 36.8529, lon: -75.9780 }, { metro: "Providence-Warwick, RI, MA", multiplier: 1.033, lat: 41.8240, lon: -71.4128 }, { metro: "Milwaukee-Waukesha, WI", multiplier: 0.948, lat: 43.0389, lon: -87.9065 }, { metro: "Jacksonville, FL", multiplier: 0.985, lat: 30.3322, lon: -81.6557 }
        ];

        const rehabItems = [
            // General Interior
            { id: 'int_paint', category: 'General Interior', name: 'Interior Painting (Walls & Trim)', type: 'sqft', cost: 4.55 },
            { id: 'flooring_lvp', category: 'General Interior', name: 'Flooring Installation (LVP)', type: 'sqft', cost: 6.05 },
            { id: 'flooring_carpet', category: 'General Interior', name: 'Carpet Installation', type: 'sqft', cost: 5 },
            { id: 'hardwood_refinish', category: 'General Interior', name: 'Hardwood Floor Refinishing', type: 'sqft', cost: 6 },
            { id: 'baseboard', category: 'General Interior', name: 'Baseboard & Trim Installation', type: 'sqft', cost: 2.5 },
            { id: 'deep_clean', category: 'General Interior', name: 'Deep Cleaning', type: 'onetime', cost: 1000 },
            { id: 'light_fixtures', category: 'General Interior', name: 'Light Fixture Replacement', type: 'item', cost: 250, label: 'fixtures' },
            { id: 'outlets_switches', category: 'General Interior', name: 'Outlets & Switches Replacement', type: 'onetime', cost: 25 },
            { id: 'door_hardware', category: 'General Interior', name: 'Door Hardware Replacement', type: 'onetime', cost: 500 },
            { id: 'int_door', category: 'General Interior', name: 'Interior Door Replacement', type: 'item', cost: 460, label: 'doors' },
            { id: 'popcorn_removal', category: 'General Interior', name: 'Popcorn Ceiling Removal', type: 'onetime', cost: 6900 },
            { id: 'attic_insulation', category: 'General Interior', name: 'Attic Insulation (Blown-in)', type: 'onetime', cost: 6000 },

            // General Exterior
            { id: 'ext_paint', category: 'General Exterior', name: 'Exterior Painting', type: 'sqft', cost: 3.75 },
            { id: 'landscaping', category: 'General Exterior', name: 'Landscaping Cleanup & Mulching', type: 'onetime', cost: 1650 },
            { id: 'entry_door', category: 'General Exterior', name: 'Entry Door Replacement (Steel)', type: 'onetime', cost: 2500 },
            { id: 'window_replace', category: 'General Exterior', name: 'Window Replacement (Vinyl)', type: 'item', cost: 600, label: 'windows' },
            { id: 'siding_vinyl', category: 'General Exterior', name: 'Siding Replacement (Vinyl)', type: 'sqft', cost: 13.00 },
            { id: 'gutters', category: 'General Exterior', name: 'Gutter Installation', type: 'linear_ft', cost: 5, label: 'linear ft' },
            { id: 'garage_door', category: 'General Exterior', name: 'Garage Door Replacement', type: 'onetime', cost: 2530 },
            { id: 'deck_repair', category: 'General Exterior', name: 'Deck Repair', type: 'onetime', cost: 5800 },
            { id: 'deck_add', category: 'General Exterior', name: 'Deck Addition (Wood)', type: 'onetime', cost: 13500 },
            { id: 'fence_install', category: 'General Exterior', name: 'Fence Installation (Wood)', type: 'linear_ft', cost: 52, label: 'linear ft' },
            { id: 'driveway_seal', category: 'General Exterior', name: 'Driveway Sealing (Asphalt)', type: 'onetime', cost: 1050 },
            { id: 'stone_veneer', category: 'General Exterior', name: 'Manufactured Stone Veneer Accent', type: 'onetime', cost: 2200 },

            // Major Systems & Utilities
            { id: 'hvac', category: 'Major Systems & Utilities', name: 'HVAC System Replacement', type: 'onetime', cost: 10350 },
            { id: 'water_heater', category: 'Major Systems & Utilities', name: 'Water Heater Replacement', type: 'onetime', cost: 1500 },
            { id: 'roof', category: 'Major Systems & Utilities', name: 'Roof Replacement (Asphalt)', type: 'onetime', cost: 20000 },
            { id: 'elec_panel', category: 'Major Systems & Utilities', name: 'Electrical Panel Upgrade', type: 'onetime', cost: 2875 },
            { id: 'foundation_repair', category: 'Major Systems & Utilities', name: 'Foundation Repair (Piers)', type: 'onetime', cost: 5000 },
            { id: 'pest_control', category: 'Major Systems & Utilities', name: 'Pest Control (General)', type: 'onetime', cost: 460 },
            { id: 'termite', category: 'Major Systems & Utilities', name: 'Termite Treatment', type: 'onetime', cost: 2070 },
            { id: 'sump_pump', category: 'Major Systems & Utilities', name: 'Sump Pump Installation', type: 'onetime', cost: 1610 },
            { id: 'security_sys', category: 'Major Systems & Utilities', name: 'Security System Installation', type: 'onetime', cost: 1500 },
            { id: 'smart_thermostat', category: 'Major Systems & Utilities', name: 'Smart Thermostat Installation', type: 'onetime', cost: 430 },
            { id: 'garage_opener', category: 'Major Systems & Utilities', name: 'Garage Door Opener Installation', type: 'onetime', cost: 1000 },

            // Kitchen Remodel
            { id: 'k_demo_cosmetic', category: 'Kitchen Remodel', name: 'Demolition (Cosmetic)', type: 'onetime', cost: 1500 },
            { id: 'k_demo_studs', category: 'Kitchen Remodel', name: 'Demolition to Studs', type: 'onetime', cost: 3500 },
            { id: 'k_framing', category: 'Kitchen Remodel', name: 'Structural & Framing (Layout Change)', type: 'onetime', cost: 4500 },
            { id: 'k_mep_overhaul', category: 'Kitchen Remodel', name: 'Full MEP Overhaul (New Wiring & Plumbing)', type: 'onetime', cost: 6000 },
            { id: 'k_insulation', category: 'Kitchen Remodel', name: 'Insulation & Drywall Installation', type: 'sqft', cost: 3.5 },
            { id: 'k_cabinet_paint', category: 'Kitchen Remodel', name: 'Cabinet Painting', type: 'onetime', cost: 2250 },
            { id: 'k_cabinets_low', category: 'Kitchen Remodel', name: 'New Cabinets (Low-Grade)', type: 'onetime', cost: 5000 },
            { id: 'k_cabinets_mid', category: 'Kitchen Remodel', name: 'New Cabinets (Mid-Grade)', type: 'onetime', cost: 9500 },
            { id: 'k_counter_entry', category: 'Kitchen Remodel', name: 'Countertops (Entry-Level Quartz)', type: 'onetime', cost: 3800 },
            { id: 'k_counter_mid', category: 'Kitchen Remodel', name: 'Countertops (Mid-Grade Quartz)', type: 'onetime', cost: 5500 },
            { id: 'k_appliances', category: 'Kitchen Remodel', name: 'Appliance Package (3-Piece Stainless)', type: 'onetime', cost: 3700 },
            { id: 'k_backsplash', category: 'Kitchen Remodel', name: 'Tile Backsplash Installation', type: 'onetime', cost: (35 + 37.5)/2 * 30 }, // Averaging and assuming 30 sqft
            { id: 'k_sink_faucet', category: 'Kitchen Remodel', name: 'Kitchen Sink & Faucet Replacement', type: 'onetime', cost: 865 },
            { id: 'k_disposal', category: 'Kitchen Remodel', name: 'Garbage Disposal Installation', type: 'onetime', cost: 430 },
            { id: 'k_mep_updates', category: 'Kitchen Remodel', name: 'MEP Updates (GFCI, valves, etc.)', type: 'onetime', cost: 650 },

            // Bathroom Remodel
            { id: 'b_demo_cosmetic', category: 'Bathroom Remodel', name: 'Demolition (Cosmetic)', type: 'onetime', cost: 1800 },
            { id: 'b_demo_studs', category: 'Bathroom Remodel', name: 'Demolition to Studs', type: 'onetime', cost: 2500 },
            { id: 'b_framing', category: 'Bathroom Remodel', name: 'Structural & Framing (Layout Change)', type: 'onetime', cost: 3000 },
            { id: 'b_mep_overhaul', category: 'Bathroom Remodel', name: 'Full MEP Overhaul (New Wiring & Plumbing)', type: 'onetime', cost: 7500 },
            { id: 'b_insulation', category: 'Bathroom Remodel', name: 'Insulation & Drywall Installation', type: 'onetime', cost: 3500 },
            { id: 'b_reglaze', category: 'Bathroom Remodel', name: 'Bathtub/Shower Reglazing', type: 'onetime', cost: 550 },
            { id: 'b_tub_combo', category: 'Bathroom Remodel', name: 'Tub/Shower Combo Replacement', type: 'onetime', cost: 5175 },
            { id: 'b_tile', category: 'Bathroom Remodel', name: 'Tile Installation (Floor & Walls)', type: 'onetime', cost: 4500 },
            { id: 'b_vanity', category: 'Bathroom Remodel', name: 'Bathroom Vanity & Top Replacement', type: 'onetime', cost: 1380 },
            { id: 'b_toilet', category: 'Bathroom Remodel', name: 'Toilet Replacement', type: 'onetime', cost: 520 },
            { id: 'b_fixtures', category: 'Bathroom Remodel', name: 'Fixtures, Mirror & Lighting', type: 'onetime', cost: 1500 },
            { id: 'b_mep_updates', category: 'Bathroom Remodel', name: 'MEP Updates (GFCI, valves, etc.)', type: 'onetime', cost: 1125 },
        ];
        
        // --- STATE ---
        let currentMetroMultiplier = 1.0;

        // --- DOM ELEMENTS ---
        const inputs = {
            sqft: document.getElementById('sqft'),
            baths: document.getElementById('baths'),
            zipcode: document.getElementById('zipcode'),
            address: document.getElementById('address'),
            userEmail: document.getElementById('user-email'),
        };

        const outputs = {
            totalRehabCost: document.getElementById('total-rehab-cost'),
            rehabEstimation: document.getElementById('rehab-estimation'),
            finalEstimation: document.getElementById('final-estimation'),
            metroDisplay: document.getElementById('metro-display'),
            emailStatus: document.getElementById('email-status'),
        };

        const rehabItemsContainer = document.getElementById('rehab-items');
        const emailButton = document.getElementById('email-budget-btn');
        
        // --- FUNCTIONS ---

        /**
         * Formats a number into a currency string (e.g., $1,234.56).
         */
        function formatCurrency(number) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            }).format(Math.round(number));
        }

        /**
         * Dynamically creates and populates the rehab item checkboxes by category.
         */
        function populateRehabItems() {
            const categories = [...new Set(rehabItems.map(item => item.category))];
            
            categories.forEach(category => {
                const categoryWrapper = document.createElement('div');
                categoryWrapper.className = 'bg-[#1E1E1E] p-6 rounded-xl shadow-lg';
                
                let headerHTML = `<h3 class="text-xl font-bold uppercase tracking-tighter mb-4 border-b border-slate-700 pb-2">${category}</h3>`;

                if (category === 'Bathroom Remodel') {
                    headerHTML += `
                        <div class="mb-4">
                            <label for="baths-to-remodel" class="block text-sm font-medium text-slate-400 mb-1">Number of Bathrooms to Remodel:</label>
                            <input type="number" id="baths-to-remodel" value="1" min="1" class="w-24 bg-slate-800 border border-slate-700 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-brand-fire-end">
                        </div>
                    `;
                }

                categoryWrapper.innerHTML = headerHTML;

                const itemsGrid = document.createElement('div');
                itemsGrid.className = 'grid grid-cols-1 sm:grid-cols-2 gap-4';

                rehabItems.filter(item => item.category === category).forEach(item => {
                    const itemContainer = document.createElement('div');
                    itemContainer.className = 'flex items-center justify-between bg-slate-800 p-3 rounded-lg';
                    
                    const checkboxLabelWrapper = document.createElement('div');
                    checkboxLabelWrapper.className = 'flex items-center space-x-3';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = item.id;
                    checkbox.className = 'h-5 w-5 rounded bg-slate-700 border-slate-600 text-brand-fire-end focus:ring-brand-fire-end';
                    
                    const label = document.createElement('label');
                    label.htmlFor = item.id;
                    label.textContent = item.name;
                    label.className = 'text-slate-300';

                    checkboxLabelWrapper.appendChild(checkbox);
                    checkboxLabelWrapper.appendChild(label);
                    itemContainer.appendChild(checkboxLabelWrapper);

                    if (item.type === 'item' || item.type === 'linear_ft') {
                        const quantityInput = document.createElement('input');
                        quantityInput.type = 'number';
                        quantityInput.id = `${item.id}-qty`;
                        quantityInput.min = "1";
                        quantityInput.value = "1";
                        quantityInput.placeholder = `# of ${item.label}`;
                        quantityInput.className = 'w-24 bg-slate-700 border border-slate-600 rounded-md p-1 text-center focus:outline-none focus:ring-2 focus:ring-brand-fire-end';
                        quantityInput.disabled = true;
                        itemContainer.appendChild(quantityInput);
                        
                        checkbox.addEventListener('change', () => {
                            quantityInput.disabled = !checkbox.checked;
                        });
                    }
                    
                    itemsGrid.appendChild(itemContainer);
                });
                
                categoryWrapper.appendChild(itemsGrid);
                rehabItemsContainer.appendChild(categoryWrapper);
            });
        }
        
        /**
         * Calculates the distance between two lat/lon points using the Haversine formula.
         */
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        /**
         * Fetches coordinates for a zip code and finds the closest metro area.
         */
        async function handleZipcodeChange() {
            const zip = inputs.zipcode.value;
            if (zip.length !== 5) {
                outputs.metroDisplay.textContent = '';
                currentMetroMultiplier = 1.0;
                calculateCosts();
                return;
            }

            outputs.metroDisplay.textContent = 'Finding closest metro...';

            try {
                const response = await fetch(`https://api.zippopotam.us/us/${zip}`);
                if (!response.ok) throw new Error('Invalid zip code');
                
                const data = await response.json();
                const place = data.places[0];
                const userLat = parseFloat(place.latitude);
                const userLon = parseFloat(place.longitude);
                
                let closestMetro = null;
                let minDistance = Infinity;

                metroData.forEach(metro => {
                    const distance = getDistance(userLat, userLon, metro.lat, metro.lon);
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestMetro = metro;
                    }
                });
                
                if (closestMetro) {
                    outputs.metroDisplay.textContent = `Metro: ${closestMetro.metro.split(',')[0]}`;
                    currentMetroMultiplier = closestMetro.multiplier;
                } else {
                     outputs.metroDisplay.textContent = 'Could not find metro.';
                     currentMetroMultiplier = 1.0;
                }

            } catch (error) {
                console.error("Zip code lookup failed:", error);
                outputs.metroDisplay.textContent = 'Invalid zip code.';
                currentMetroMultiplier = 1.0;
            }
            
            calculateCosts();
        }

        /**
         * Gathers all inputs and returns a detailed object with costs and an itemized list.
         */
        function getCalculationDetails() {
            const sqft = parseFloat(inputs.sqft.value) || 0;
            const bathsToRemodel = parseFloat(document.getElementById('baths-to-remodel')?.value) || 1;
            
            const itemizedList = [];
            let totalRehabCost = 0;

            rehabItems.forEach(item => {
                const checkbox = document.getElementById(item.id);
                if (!checkbox || !checkbox.checked) return;

                let itemBaseCost = 0;
                switch (item.type) {
                    case 'onetime':
                        itemBaseCost = item.cost;
                        break;
                    case 'sqft':
                        itemBaseCost = item.cost * sqft;
                        break;
                    case 'item':
                    case 'linear_ft':
                        const qty = parseFloat(document.getElementById(`${item.id}-qty`).value) || 1;
                        itemBaseCost = item.cost * qty;
                        break;
                }

                let finalItemBaseCost = itemBaseCost;
                let itemName = item.name;

                if (item.category === 'Bathroom Remodel') {
                    finalItemBaseCost *= bathsToRemodel;
                    if (bathsToRemodel > 1) {
                        itemName += ` (x${bathsToRemodel})`;
                    }
                }
                
                totalRehabCost += finalItemBaseCost;
                const adjustedItemCost = finalItemBaseCost * currentMetroMultiplier;
                itemizedList.push({ name: itemName, cost: adjustedItemCost });
            });

            const rehabEstimation = totalRehabCost * currentMetroMultiplier;
            const finalEstimation = rehabEstimation * 1.10;

            return { itemizedList, totalRehabCost, rehabEstimation, finalEstimation };
        }

        /**
         * Updates the UI with the latest cost calculations.
         */
        function calculateCosts() {
            const { totalRehabCost, rehabEstimation, finalEstimation } = getCalculationDetails();
            outputs.totalRehabCost.textContent = formatCurrency(totalRehabCost);
            outputs.rehabEstimation.textContent = formatCurrency(rehabEstimation);
            outputs.finalEstimation.textContent = formatCurrency(finalEstimation);
        }

        /**
         * Generates and sends the itemized budget to the specified webhook.
         */
        async function sendBudgetToWebhook() {
            const email = inputs.userEmail.value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                outputs.emailStatus.textContent = 'Please enter a valid email.';
                outputs.emailStatus.classList.add('text-red-500');
                inputs.userEmail.focus();
                setTimeout(() => outputs.emailStatus.textContent = '', 3000);
                return;
            }

            emailButton.disabled = true;
            emailButton.textContent = 'Generating...';
            outputs.emailStatus.textContent = '';
            outputs.emailStatus.classList.remove('text-red-500', 'text-yellow-500', 'text-green-500');

            const { itemizedList, totalRehabCost, rehabEstimation, finalEstimation } = getCalculationDetails();
            
            if (itemizedList.length === 0) {
                outputs.emailStatus.textContent = 'Please select at least one rehab item.';
                outputs.emailStatus.classList.add('text-yellow-500');
                emailButton.disabled = false;
                emailButton.textContent = 'Email Me The Full Rehab Budget';
                setTimeout(() => outputs.emailStatus.textContent = '', 3000);
                return;
            }

            const propertyAddress = inputs.address.value || 'N/A';
            const metroAreaText = outputs.metroDisplay.textContent || 'N/A';

            const budgetHtml = `
                <div style="font-family: Arial, sans-serif; color: #333; max-width: 600px; margin: auto; border: 1px solid #ddd; padding: 20px;">
                    <h1 style="color: #C84A00;">Rehab Budget Estimate</h1>
                    <p><strong>Property Address:</strong> ${propertyAddress}</p>
                    <p><strong>Closest Metro Area:</strong> ${metroAreaText.replace('Metro: ','')}</p>
                    <hr>
                    <h2 style="color: #C84A00;">Itemized Costs (Metro Adjusted)</h2>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th style="border-bottom: 2px solid #ddd; padding: 8px; text-align: left; background-color: #f9f9f9;">Item</th>
                                <th style="border-bottom: 2px solid #ddd; padding: 8px; text-align: right; background-color: #f9f9f9;">Estimated Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemizedList.map(item => `
                                <tr>
                                    <td style="border-bottom: 1px solid #eee; padding: 8px;">${item.name}</td>
                                    <td style="border-bottom: 1px solid #eee; padding: 8px; text-align: right;">${formatCurrency(item.cost)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <hr style="margin-top: 20px;">
                    <h2 style="color: #C84A00;">Summary</h2>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <td style="padding: 8px; text-align: right;"><strong>Total Base Rehab Cost:</strong></td>
                            <td style="padding: 8px; text-align: right; width: 35%;">${formatCurrency(totalRehabCost)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; text-align: right;"><strong>Metro Area Adjusted Cost:</strong></td>
                            <td style="padding: 8px; text-align: right;">${formatCurrency(rehabEstimation)}</td>
                        </tr>
                        <tr style="font-size: 1.2em; background-color: #f9f9f9;">
                            <td style="padding: 10px; text-align: right;"><strong>Final Estimate (+10% Contingency):</strong></td>
                            <td style="padding: 10px; text-align: right;"><strong>${formatCurrency(finalEstimation)}</strong></td>
                        </tr>
                    </table>
                </div>
            `;

            const webhookUrl = 'https://hook.us2.make.com/6r3eplmy3xwvg7vn7r19s377yfwyss33';
            const payload = { email: email, address: propertyAddress, budgetHtml: budgetHtml };

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    emailButton.textContent = 'Email Sent!';
                    outputs.emailStatus.textContent = 'Success! Check your inbox.';
                    outputs.emailStatus.classList.add('text-green-500');
                } else {
                    throw new Error(`Webhook failed with status: ${response.status}`);
                }
            } catch (error) {
                console.error('Webhook error:', error);
                emailButton.textContent = 'Email Me The Full Rehab Budget';
                outputs.emailStatus.textContent = 'An error occurred. Please try again.';
                outputs.emailStatus.classList.add('text-red-500');
            } finally {
                setTimeout(() => {
                    emailButton.disabled = false;
                    emailButton.textContent = 'Email Me The Full Rehab Budget';
                    outputs.emailStatus.textContent = '';
                }, 5000);
            }
        }
        
        // --- INITIALIZATION & EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            populateRehabItems();
            
            const mainFormArea = document.querySelector('.lg\\:col-span-2');
            mainFormArea.addEventListener('input', (event) => {
                 if (event.target.id !== 'zipcode') {
                    calculateCosts();
                }
            });
            
            inputs.zipcode.addEventListener('blur', handleZipcodeChange);
            emailButton.addEventListener('click', sendBudgetToWebhook);
        });

    </script>
</body>
</html>



​