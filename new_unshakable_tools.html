<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unshakable Fix & Flip Deal Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Base styling adhering to the brand guide */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212; /* Charcoal */
            color: #FFFFFF;
        }

        /* Custom styles for branded sliders */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #4A5568; /* Slate gray for track */
            border-radius: 5px;
            outline: none;
            opacity: 0.9;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        /* Thumb (the slider handle) styling */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background-image: linear-gradient(to right, #C84A00, #FF6A00); /* Fire Gradient */
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #FFFFFF;
            margin-top: -8px; /* Center thumb on the track */
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background-image: linear-gradient(to right, #C84A00, #FF6A00); /* Fire Gradient */
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #FFFFFF;
        }

        /* Custom styles for inputs */
        input[type="number"], input[type="email"], input[type="text"], textarea, select {
            background-color: #2D3748; /* Darker slate */
            color: #FFFFFF;
            border: 1px solid #4A5568;
        }
        input[type="number"] {
             -moz-appearance: textfield; /* Firefox */
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Gradient text for key metrics */
        .gradient-text {
            background-image: linear-gradient(to right, #F2C14E, #FFC94E); /* Gold Gradient */
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Sensitivity Table Styling */
        #profit_table_container {
            overflow-x: auto;
        }
        #profit_table th, #profit_table td {
            white-space: nowrap;
            padding: 0.6rem 0.85rem;
            text-align: center;
        }
        #profit_table th {
            background-color: #1a202c;
        }
        #profit_table td.in-range {
            background-color: rgba(16, 185, 129, 0.1);
        }
        #profit_table td.current-deal {
            background-image: linear-gradient(to right, #c84a00, #ff6a00) !important;
            color: #FFFFFF;
            font-weight: bold;
            outline: 2px solid #FFC94E;
        }
        .prose-custom ul {
            list-style-position: inside;
            padding-left: 0;
        }
        .prose-custom ul > li::marker {
            color: #FFC94E;
        }
        
        /* Styles from Rehab Estimator */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
        input:disabled, button:disabled {
            background-color: #2d3748 !important;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        /* Style for active nav button */
        .nav-button.active {
             background-image: linear-gradient(to right, #C84A00, #FF6A00);
             color: #FFFFFF;
        }

        .nav-button:focus-visible {
            outline: 2px solid #FFC94E;
            outline-offset: 2px;
        }

        .nav-button .nav-chevron {
            transition: transform 0.2s ease, opacity 0.2s ease;
            opacity: 0.6;
        }

        .nav-button.active .nav-chevron {
            opacity: 0.95;
            transform: translateX(2px);
        }

        @media (max-width: 639px) {
            .nav-button {
                border-radius: 0.75rem;
            }

            .nav-button.active {
                box-shadow: 0 12px 24px rgba(200, 74, 0, 0.35);
            }
        }
    </style>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.546.0",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="antialiased">
    <div id="root"></div>

<script type="text/babel" data-type="module">
// External Dependencies
import React, { useState, useCallback, useMemo, useEffect } from 'react';
import ReactDOM from 'react-dom/client';
import { Construction, TrendingUp, Inbox, SlidersHorizontal, Landmark, BarChart2, Table, Mail, Info, ChevronDown } from 'lucide-react';

// --- From types.ts ---
const View = {
    RehabEstimator: 'rehabEstimatorView',
    ProfitAnalysis: 'profitAnalysisView',
    SubmitDeal: 'submitDealView',
};

// --- From constants.ts ---
const METRO_DATA = [ { metro: "New York-Newark-Jersey City, NY, NJ, PA", multiplier: 1.252, lat: 40.7128, lon: -74.0060 }, { metro: "Los Angeles-Long Beach-Anaheim, CA", multiplier: 1.233, lat: 34.0522, lon: -118.2437 }, { metro: "Chicago-Naperville-Elgin, IL, IN, WI", multiplier: 1.024, lat: 41.8781, lon: -87.6298 }, { metro: "Dallas-Fort Worth-Arlington, TX", multiplier: 1.005, lat: 32.7767, lon: -96.7970 }, { metro: "Houston-The Woodlands-Sugar Land, TX", multiplier: 0.946, lat: 29.7604, lon: -95.3698 }, { metro: "Miami-Fort Lauderdale-Pompano Beach, FL", multiplier: 1.119, lat: 25.7617, lon: -80.1918 }, { metro: "Philadelphia-Camden-Wilmington, PA, NJ, DE, MD", multiplier: 1.037, lat: 39.9526, lon: -75.1652 }, { metro: "Atlanta-Sandy Springs-Alpharetta, GA", multiplier: 0.957, lat: 33.7490, lon: -84.3880 }, { metro: "Washington-Arlington-Alexandria, DC, VA, MD, WV", multiplier: 1.157, lat: 38.9072, lon: -77.0369 }, { metro: "Boston-Cambridge-Newton, MA, NH", multiplier: 1.137, lat: 42.3601, lon: -71.0589 }, { metro: "Phoenix-Mesa-Chandler, AZ", multiplier: 0.999, lat: 33.4484, lon: -112.0740 }, { metro: "San Francisco-Oakland-Berkeley, CA", multiplier: 1.299, lat: 37.7749, lon: -122.4194 }, { metro: "Riverside-San Bernardino-Ontario, CA", multiplier: 1.096, lat: 34.0560, lon: -117.4050 }, { metro: "Detroit-Warren-Dearborn, MI", multiplier: 0.916, lat: 42.3314, lon: -83.0458 }, { metro: "Seattle-Tacoma-Bellevue, WA", multiplier: 1.168, lat: 47.6062, lon: -122.3321 }, { metro: "Minneapolis-St. Paul-Bloomington, MN, WI", multiplier: 1.006, lat: 44.9778, lon: -93.2650 }, { metro: "San Diego-Chula Vista-Carlsbad, CA", multiplier: 1.168, lat: 32.7157, lon: -117.1611 }, { metro: "Tampa-St. Petersburg-Clearwater, FL", multiplier: 1.002, lat: 27.9641, lon: -82.4524 }, { metro: "Denver-Aurora-Lakewood, CO", multiplier: 1.056, lat: 39.7392, lon: -104.9903 }, { metro: "Baltimore-Columbia-Towson, MD", multiplier: 1.066, lat: 39.2904, lon: -76.6122 }, { metro: "St. Louis, MO, IL", multiplier: 0.89, lat: 38.6270, lon: -90.1994 }, { metro: "Orlando-Kissimmee-Sanford, FL", multiplier: 0.993, lat: 28.5383, lon: -81.3792 }, { metro: "Charlotte-Concord-Gastonia, NC, SC", multiplier: 0.948, lat: 35.2271, lon: -80.8431 }, { metro: "San Antonio-New Braunfels, TX", multiplier: 0.916, lat: 29.4241, lon: -98.4936 }, { metro: "Portland-Vancouver-Hillsboro, OR, WA", multiplier: 1.054, lat: 45.5051, lon: -122.6750 }, { metro: "Sacramento-Roseville-Folsom, CA", multiplier: 1.077, lat: 38.5816, lon: -121.4944 }, { metro: "Pittsburgh, PA", multiplier: 0.914, lat: 40.4406, lon: -79.9959 }, { metro: "Austin-Round Rock-Georgetown, TX", multiplier: 1.011, lat: 30.2672, lon: -97.7431 }, { metro: "Las Vegas-Henderson-Paradise, NV", multiplier: 0.996, lat: 36.1699, lon: -115.1398 }, { metro: "Cincinnati, OH, KY, IN", multiplier: 0.914, lat: 39.1031, lon: -84.5120 }, { metro: "Kansas City, MO, KS", multiplier: 0.93, lat: 39.0997, lon: -94.5786 }, { metro: "Columbus, OH", multiplier: 0.929, lat: 39.9612, lon: -82.9988 }, { metro: "Cleveland-Elyria, OH", multiplier: 0.912, lat: 41.4993, lon: -81.6944 }, { metro: "Indianapolis-Carmel-Anderson, IN", multiplier: 0.903, lat: 39.7684, lon: -86.1581 }, { metro: "San Jose-Sunnyvale-Santa Clara, CA", multiplier: 1.303, lat: 37.3382, lon: -121.8863 }, { metro: "Nashville-Davidson--Murfreesboro--Franklin, TN", multiplier: 0.958, lat: 36.1627, lon: -86.7816 }, { metro: "Virginia Beach-Norfolk-Newport News, VA, NC", multiplier: 0.97, lat: 36.8529, lon: -75.9780 }, { metro: "Providence-Warwick, RI, MA", multiplier: 1.033, lat: 41.8240, lon: -71.4128 }, { metro: "Milwaukee-Waukesha, WI", multiplier: 0.948, lat: 43.0389, lon: -87.9065 }, { metro: "Jacksonville, FL", multiplier: 0.985, lat: 30.3322, lon: -81.6557 } ];
const REHAB_ITEMS = [ { id: 'int_paint', category: 'General Interior', name: 'Interior Painting (Walls & Trim)', type: 'sqft', cost: 4.55, areaType: 'percentage' }, { id: 'flooring_lvp', category: 'General Interior', name: 'Flooring Installation (LVP)', type: 'sqft', cost: 6.05, areaType: 'percentage' }, { id: 'flooring_carpet', category: 'General Interior', name: 'Carpet Installation', type: 'sqft', cost: 5, areaType: 'percentage' }, { id: 'hardwood_refinish', category: 'General Interior', name: 'Hardwood Floor Refinishing', type: 'sqft', cost: 6, areaType: 'percentage' }, { id: 'baseboard', category: 'General Interior', name: 'Baseboard & Trim Installation', type: 'sqft', cost: 2.5, areaType: 'percentage' }, { id: 'deep_clean', category: 'General Interior', name: 'Deep Cleaning', type: 'onetime', cost: 1000 }, { id: 'light_fixtures', category: 'General Interior', name: 'Light Fixture Replacement', type: 'item', cost: 250, label: 'fixtures' }, { id: 'outlets_switches', category: 'General Interior', name: 'Outlets & Switches Replacement', type: 'onetime', cost: 25 }, { id: 'door_hardware', category: 'General Interior', name: 'Door Hardware Replacement', type: 'onetime', cost: 500 }, { id: 'int_door', category: 'General Interior', name: 'Interior Door Replacement', type: 'item', cost: 460, label: 'doors' }, { id: 'popcorn_removal', category: 'General Interior', name: 'Popcorn Ceiling Removal', type: 'sqft', cost: 4.6, areaType: 'percentage' }, { id: 'attic_insulation', category: 'General Interior', name: 'Attic Insulation (Blown-in)', type: 'onetime', cost: 6000 }, { id: 'ext_paint', category: 'General Exterior', name: 'Exterior Painting', type: 'sqft', cost: 3.75, areaType: 'percentage' }, { id: 'landscaping', category: 'General Exterior', name: 'Landscaping Cleanup & Mulching', type: 'onetime', cost: 1650 }, { id: 'entry_door', category: 'General Exterior', name: 'Entry Door Replacement (Steel)', type: 'onetime', cost: 2500 }, { id: 'window_replace', category: 'General Exterior', name: 'Window Replacement (Vinyl)', type: 'item', cost: 600, label: 'windows' }, { id: 'siding_vinyl', category: 'General Exterior', name: 'Siding Replacement (Vinyl)', type: 'sqft', cost: 13.00, areaType: 'percentage' }, { id: 'gutters', category: 'General Exterior', name: 'Gutter Installation', type: 'linear_ft', cost: 5, label: 'linear ft' }, { id: 'garage_door', category: 'General Exterior', name: 'Garage Door Replacement', type: 'onetime', cost: 2530 }, { id: 'deck_repair', category: 'General Exterior', name: 'Deck Repair', type: 'onetime', cost: 5800 }, { id: 'deck_add', category: 'General Exterior', name: 'Deck Addition (Wood)', type: 'onetime', cost: 13500 }, { id: 'fence_install', category: 'General Exterior', name: 'Fence Installation (Wood)', type: 'linear_ft', cost: 52, label: 'linear ft' }, { id: 'driveway_seal', category: 'General Exterior', name: 'Driveway Sealing (Asphalt)', type: 'onetime', cost: 1050 }, { id: 'stone_veneer', category: 'General Exterior', name: 'Manufactured Stone Veneer Accent', type: 'onetime', cost: 2200 }, { id: 'hvac', category: 'Major Systems & Utilities', name: 'HVAC System Replacement', type: 'onetime', cost: 10350 }, { id: 'water_heater', category: 'Major Systems & Utilities', name: 'Water Heater Replacement', type: 'onetime', cost: 1500 }, { id: 'roof', category: 'Major Systems & Utilities', name: 'Roof Replacement (Asphalt)', type: 'onetime', cost: 20000 }, { id: 'elec_panel', category: 'Major Systems & Utilities', name: 'Electrical Panel Upgrade', type: 'onetime', cost: 2875 }, { id: 'foundation_repair', category: 'Major Systems & Utilities', name: 'Foundation Repair (Piers)', type: 'onetime', cost: 5000 }, { id: 'pest_control', category: 'Major Systems & Utilities', name: 'Pest Control (General)', type: 'onetime', cost: 460 }, { id: 'termite', category: 'Major Systems & Utilities', name: 'Termite Treatment', type: 'onetime', cost: 2070 }, { id: 'sump_pump', category: 'Major Systems & Utilities', name: 'Sump Pump Installation', type: 'onetime', cost: 1610 }, { id: 'security_sys', category: 'Major Systems & Utilities', name: 'Security System Installation', type: 'onetime', cost: 1500 }, { id: 'smart_thermostat', category: 'Major Systems & Utilities', name: 'Smart Thermostat Installation', type: 'onetime', cost: 430 }, { id: 'garage_opener', category: 'Major Systems & Utilities', name: 'Garage Door Opener Installation', type: 'onetime', cost: 1000 }, { id: 'k_demo_cosmetic', category: 'Kitchen Remodel', name: 'Demolition (Cosmetic)', type: 'onetime', cost: 1500 }, { id: 'k_demo_studs', category: 'Kitchen Remodel', name: 'Demolition to Studs', type: 'onetime', cost: 3500 }, { id: 'k_framing', category: 'Kitchen Remodel', name: 'Structural & Framing (Layout Change)', type: 'onetime', cost: 4500 }, { id: 'k_mep_overhaul', category: 'Kitchen Remodel', name: 'Full MEP Overhaul (New Wiring & Plumbing)', type: 'onetime', cost: 6000 }, { id: 'k_insulation', category: 'Kitchen Remodel', name: 'Insulation & Drywall Installation', type: 'sqft', cost: 3.5, areaType: 'percentage' }, { id: 'k_cabinet_paint', category: 'Kitchen Remodel', name: 'Cabinet Painting', type: 'onetime', cost: 2250 }, { id: 'k_cabinets_low', category: 'Kitchen Remodel', name: 'New Cabinets (Low-Grade)', type: 'onetime', cost: 5000 }, { id: 'k_cabinets_mid', category: 'Kitchen Remodel', name: 'New Cabinets (Mid-Grade)', type: 'onetime', cost: 9500 }, { id: 'k_counter_entry', category: 'Kitchen Remodel', name: 'Countertops (Entry-Level Quartz)', type: 'onetime', cost: 3800 }, { id: 'k_counter_mid', category: 'Kitchen Remodel', name: 'Countertops (Mid-Grade Quartz)', type: 'onetime', cost: 5500 }, { id: 'k_appliances', category: 'Kitchen Remodel', name: 'Appliance Package (3-Piece Stainless)', type: 'onetime', cost: 3700 }, { id: 'k_backsplash', category: 'Kitchen Remodel', name: 'Tile Backsplash Installation', type: 'onetime', cost: (35 + 37.5)/2 * 30 }, { id: 'k_sink_faucet', category: 'Kitchen Remodel', name: 'Kitchen Sink & Faucet Replacement', type: 'onetime', cost: 865 }, { id: 'k_disposal', category: 'Kitchen Remodel', name: 'Garbage Disposal Installation', type: 'onetime', cost: 430 }, { id: 'k_mep_updates', category: 'Kitchen Remodel', name: 'MEP Updates (GFCI, valves, etc.)', type: 'onetime', cost: 650 }, { id: 'b_demo_cosmetic', category: 'Bathroom Remodel', name: 'Demolition (Cosmetic)', type: 'onetime', cost: 1800 }, { id: 'b_demo_studs', category: 'Bathroom Remodel', name: 'Demolition to Studs', type: 'onetime', cost: 2500 }, { id: 'b_framing', category: 'Bathroom Remodel', name: 'Structural & Framing (Layout Change)', type: 'onetime', cost: 3000 }, { id: 'b_mep_overhaul', category: 'Bathroom Remodel', name: 'Full MEP Overhaul (New Wiring & Plumbing)', type: 'onetime', cost: 7500 }, { id: 'b_insulation', category: 'Bathroom Remodel', name: 'Insulation & Drywall Installation', type: 'onetime', cost: 3500 }, { id: 'b_reglaze', category: 'Bathroom Remodel', name: 'Bathtub/Shower Reglazing', type: 'onetime', cost: 550 }, { id: 'b_tub_combo', category: 'Bathroom Remodel', name: 'Tub/Shower Combo Replacement', type: 'onetime', cost: 5175 }, { id: 'b_tile', category: 'Bathroom Remodel', name: 'Tile Installation (Floor & Walls)', type: 'onetime', cost: 4500 }, { id: 'b_vanity', category: 'Bathroom Remodel', name: 'Bathroom Vanity & Top Replacement', type: 'onetime', cost: 1380 }, { id: 'b_toilet', category: 'Bathroom Remodel', name: 'Toilet Replacement', type: 'onetime', cost: 520 }, { id: 'b_fixtures', category: 'Bathroom Remodel', name: 'Fixtures, Mirror & Lighting', type: 'onetime', cost: 1500 }, { id: 'b_mep_updates', category: 'Bathroom Remodel', name: 'MEP Updates (GFCI, valves, etc.)', type: 'onetime', cost: 1125 }, ];

// --- From components/RehabEstimator.tsx ---
const itemGroups = {
    'grouped_k_demo': { name: 'Kitchen Demolition', default: 'k_demo_cosmetic', options: ['k_demo_cosmetic', 'k_demo_studs'] },
    'grouped_k_cabinets': { name: 'New Cabinets', default: 'k_cabinets_mid', options: ['k_cabinets_low', 'k_cabinets_mid'] },
    'grouped_k_countertops': { name: 'Countertops', default: 'k_counter_entry', options: ['k_counter_entry', 'k_counter_mid'] },
    'grouped_b_demo': { name: 'Bathroom Demolition', default: 'b_demo_cosmetic', options: ['b_demo_cosmetic', 'b_demo_studs'] },
};

const rehabItemMap = REHAB_ITEMS.reduce((acc, item) => {
    acc[item.id] = item;
    return acc;
}, {});

const formatCurrencySimple = (number) => {
    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(Math.round(number));
};

const RehabEstimator = ({ onAnalysisTransfer }) => {
    const [propertyDetails, setPropertyDetails] = useState({ address: '', zipcode: '', beds: '', baths: '', sqft: '' });
    const [metroDisplay, setMetroDisplay] = useState('');
    const [currentMetroMultiplier, setCurrentMetroMultiplier] = useState(1.0);
    const [selectedItems, setSelectedItems] = useState({});
    const [itemQuantities, setItemQuantities] = useState({});
    const [itemPercentages, setItemPercentages] = useState({});
    const [selectedQualities, setSelectedQualities] = useState({});
    const [bathsToRemodel, setBathsToRemodel] = useState('1');
    const [customItems, setCustomItems] = useState({});
    const [userEmail, setUserEmail] = useState('');
    const [emailStatus, setEmailStatus] = useState({ message: '', type: '' });
    const [isSubmitting, setIsSubmitting] = useState(false);

    const displayItems = useMemo(() => {
        const processedItems = [];
        const groupedItemIds = new Set(Object.values(itemGroups).flatMap(g => g.options));
        
        REHAB_ITEMS.forEach(item => {
            if (!groupedItemIds.has(item.id)) {
                processedItems.push(item);
            }
        });

        Object.entries(itemGroups).forEach(([groupId, groupInfo]) => {
            const firstItem = rehabItemMap[groupInfo.options[0]];
            if (firstItem) {
                processedItems.push({
                    id: groupId,
                    category: firstItem.category,
                    name: groupInfo.name,
                    type: 'grouped'
                });
            }
        });

        processedItems.sort((a, b) => {
            const aIndex = REHAB_ITEMS.findIndex(item => item.id === (a.type === 'grouped' ? itemGroups[a.id].options[0] : a.id));
            const bIndex = REHAB_ITEMS.findIndex(item => item.id === (b.type === 'grouped' ? itemGroups[b.id].options[0] : b.id));
            return aIndex - bIndex;
        });

        return processedItems;
    }, []);
    
    const categories = useMemo(() => {
        const categorySet = new Set();
        displayItems.forEach(item => categorySet.add(item.category));
        return Array.from(categorySet);
    }, [displayItems]);

    const calculationDetails = useMemo(() => {
        const sqft = parseFloat(propertyDetails.sqft) || 0;
        const numBathsToRemodel = parseFloat(bathsToRemodel) || 1;
        let totalRehabCost = 0;
        const itemizedList = [];

        Object.keys(selectedItems).forEach(id => {
            if (!selectedItems[id]) return;

            let item;
            let itemName;
            
            if (id.startsWith('grouped_')) {
                const selectedOptionId = selectedQualities[id] || itemGroups[id]?.default;
                item = rehabItemMap[selectedOptionId];
                const qualityLabel = item.name.match(/\(([^)]+)\)/)?.[1] || '';
                itemName = `${itemGroups[id].name} (${qualityLabel.trim()})`;
            } else {
                item = rehabItemMap[id];
                itemName = item?.name;
            }

            if (!item) return;

            let itemBaseCost = 0;
            switch (item.type) {
                case 'onetime': itemBaseCost = item.cost; break;
                case 'sqft':
                    if (item.areaType === 'percentage') {
                        const percentage = parseFloat(itemPercentages[item.id] || '100');
                        itemBaseCost = item.cost * sqft * (percentage / 100);
                    } else {
                        itemBaseCost = item.cost * sqft;
                    }
                    break;
                case 'item': case 'linear_ft':
                    const qty = parseFloat(itemQuantities[item.id] || '1');
                    itemBaseCost = item.cost * qty;
                    break;
            }
            
            let finalItemBaseCost = itemBaseCost;
            if (item.category === 'Bathroom Remodel') {
                finalItemBaseCost *= numBathsToRemodel;
                if (numBathsToRemodel > 1) itemName += ` (x${numBathsToRemodel})`;
            }
            totalRehabCost += finalItemBaseCost;
            itemizedList.push({ name: itemName, cost: finalItemBaseCost * currentMetroMultiplier });
        });

        Object.values(customItems).flat().forEach((item) => {
            const cost = parseFloat(item.cost) || 0;
            totalRehabCost += cost;
            if(cost > 0) itemizedList.push({ name: item.name || 'Custom Item', cost: cost * currentMetroMultiplier });
        });

        const rehabEstimation = totalRehabCost * currentMetroMultiplier;
        const finalEstimation = rehabEstimation * 1.10;

        return { itemizedList, totalRehabCost, rehabEstimation, finalEstimation };
    }, [propertyDetails.sqft, bathsToRemodel, selectedItems, itemPercentages, itemQuantities, selectedQualities, customItems, currentMetroMultiplier]);


    const handleZipcodeChange = useCallback(async (zip) => {
        if (zip.length !== 5) {
            setMetroDisplay('');
            setCurrentMetroMultiplier(1.0);
            return;
        }
        setMetroDisplay('Finding closest metro...');
        try {
            const response = await fetch(`https://api.zippopotam.us/us/${zip}`);
            if (!response.ok) throw new Error('Invalid zip code');
            const data = await response.json();
            const place = data.places[0];
            const userLat = parseFloat(place.latitude);
            const userLon = parseFloat(place.longitude);
            const getDistance = (lat1, lon1, lat2, lon2) => {
                const R = 6371; const dLat = (lat2 - lat1) * Math.PI / 180; const dLon = (lon2 - lon1) * Math.PI / 180; const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2); const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); return R * c;
            };
            let closestMetro = null;
            let minDistance = Infinity;
            METRO_DATA.forEach(metro => {
                const distance = getDistance(userLat, userLon, metro.lat, metro.lon);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestMetro = metro;
                }
            });
            if (closestMetro) {
                setMetroDisplay(`Metro: ${closestMetro.metro.split(',')[0]}`);
                setCurrentMetroMultiplier(closestMetro.multiplier);
            } else {
                setMetroDisplay('Could not find metro.');
                setCurrentMetroMultiplier(1.0);
            }
        } catch (error) {
            console.error("Zip code lookup failed:", error);
            setMetroDisplay('Invalid zip code.');
            setCurrentMetroMultiplier(1.0);
        }
    }, []);
    
    const handleCheckboxChange = (id, checked) => {
        setSelectedItems(p => ({ ...p, [id]: checked }));
        if (id.startsWith('grouped_') && checked && !selectedQualities[id]) {
            setSelectedQualities(p => ({ ...p, [id]: itemGroups[id].default }));
        }
    };

    useEffect(() => {
        const handler = setTimeout(() => {
            if (propertyDetails.zipcode) {
                handleZipcodeChange(propertyDetails.zipcode);
            }
        }, 500);
        return () => clearTimeout(handler);
    }, [propertyDetails.zipcode, handleZipcodeChange]);

    const handleAddCustomItem = (category) => {
        const newCustomItem = { id: Date.now().toString(), name: '', cost: '' };
        setCustomItems(prev => ({
            ...prev,
            [category]: [...(prev[category] || []), newCustomItem]
        }));
    };
    
    const handleCustomItemChange = (category, id, field, value) => {
        setCustomItems(prev => ({
            ...prev,
            [category]: prev[category].map(item => item.id === id ? { ...item, [field]: value } : item)
        }));
    };

    const handleRemoveCustomItem = (category, id) => {
        setCustomItems(prev => ({
            ...prev,
            [category]: prev[category].filter(item => item.id !== id)
        }));
    };

    const handleSendEmail = async () => {
        if (!userEmail || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(userEmail)) {
            setEmailStatus({ message: 'Please enter a valid email.', type: 'red' });
            return;
        }
        if (calculationDetails.itemizedList.length === 0) {
            setEmailStatus({ message: 'Please select at least one rehab item.', type: 'yellow' });
            return;
        }
        setIsSubmitting(true);
        setEmailStatus({ message: 'Sending...', type: 'gray' });

        const { itemizedList, totalRehabCost, rehabEstimation, finalEstimation } = calculationDetails;
        
        const getReportItemName = (rawName) => {
            const match = rawName.match(/(.*) \(([^)]+)\)/);
            if (!match) return rawName;

            const baseName = match[1];
            const quality = match[2];

            const groupKey = Object.keys(itemGroups).find(k => itemGroups[k].name === baseName);
            if (groupKey) {
                 const selectedOptionId = Object.keys(selectedQualities).includes(groupKey) ? selectedQualities[groupKey] : itemGroups[groupKey].default;
                 const originalItem = rehabItemMap[selectedOptionId];
                 if (originalItem && originalItem.name.includes(`(${quality})`)) {
                     return `${baseName} (${quality})`;
                 }
            }
            return rawName;
        };

        const budgetHtml = `<div style="font-family: Arial, sans-serif; color: #333; max-width: 600px; margin: auto; border: 1px solid #ddd; padding: 20px;"><h1 style="color: #C84A00;">Rehab Budget Estimate</h1><p><strong>Property Address:</strong> ${propertyDetails.address || 'N/A'}</p><p><strong>Closest Metro Area:</strong> ${metroDisplay.replace('Metro: ','')}</p><hr><h2 style="color: #C84A00;">Itemized Costs (Metro Adjusted)</h2><table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="border-bottom: 2px solid #ddd; padding: 8px; text-align: left; background-color: #f9f9f9;">Item</th><th style="border-bottom: 2px solid #ddd; padding: 8px; text-align: right; background-color: #f9f9f9;">Estimated Cost</th></tr></thead><tbody>${itemizedList.map(item => `<tr><td style="border-bottom: 1px solid #eee; padding: 8px;">${getReportItemName(item.name)}</td><td style="border-bottom: 1px solid #eee; padding: 8px; text-align: right;">${formatCurrencySimple(item.cost)}</td></tr>`).join('')}</tbody></table><hr style="margin-top: 20px;"><h2 style="color: #C84A00;">Summary</h2><table style="width: 100%; border-collapse: collapse;"><tr><td style="padding: 8px; text-align: right;"><strong>Total Base Rehab Cost:</strong></td><td style="padding: 8px; text-align: right; width: 35%;">${formatCurrencySimple(totalRehabCost)}</td></tr><tr><td style="padding: 8px; text-align: right;"><strong>Metro Area Adjusted Cost:</strong></td><td style="padding: 8px; text-align: right;">${formatCurrencySimple(rehabEstimation)}</td></tr><tr style="font-size: 1.2em; background-color: #f9f9f9;"><td style="padding: 10px; text-align: right;"><strong>Final Estimate (+10% Contingency):</strong></td><td style="padding: 10px; text-align: right;"><strong>${formatCurrencySimple(finalEstimation)}</strong></td></tr></table></div>`;
        const webhookUrl = 'https://hook.us2.make.com/6r3eplmy3xwvg7vn7r19s377yfwyss33';
        const payload = { email: userEmail, address: propertyDetails.address || 'N/A', budgetHtml: budgetHtml };

        try {
            const response = await fetch(webhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (response.ok) {
                setEmailStatus({ message: 'Success! Check your inbox.', type: 'green' });
            } else {
                throw new Error(`Webhook failed with status: ${response.status}`);
            }
        } catch (error) {
            console.error('Webhook error:', error);
            setEmailStatus({ message: 'An error occurred. Please try again.', type: 'red' });
        } finally {
            setIsSubmitting(false);
            setTimeout(() => setEmailStatus({ message: '', type: '' }), 5000);
        }
    };


    return (
        <div className="container mx-auto p-4 md:p-8">
            <header className="text-center mb-12">
                <h1 className="text-4xl md:text-5xl font-extrabold uppercase tracking-tighter text-white">Rehab Cost Estimator</h1>
                <p className="text-slate-400 mt-2 max-w-2xl mx-auto">A direct, authoritative, and value-driven tool to project your fix-and-flip costs instantly.</p>
            </header>
            <main className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-2 space-y-8">
                    <section id="property-details" className="bg-[#1E1E1E] p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold uppercase tracking-tighter mb-4 border-b border-slate-700 pb-2">Property Details</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <input type="text" placeholder="Property Address" className="w-full rounded-lg p-3" value={propertyDetails.address} onChange={e => setPropertyDetails(p => ({ ...p, address: e.target.value }))} />
                            <div className="relative">
                                <input type="text" placeholder="Property Zip Code" className="w-full rounded-lg p-3" value={propertyDetails.zipcode} onChange={e => setPropertyDetails(p => ({ ...p, zipcode: e.target.value.replace(/\D/g, '').slice(0, 5) }))} maxLength={5} />
                                <p className="text-xs text-slate-400 mt-1 h-4">{metroDisplay}</p>
                            </div>
                            <input type="number" placeholder="# of Beds" className="w-full rounded-lg p-3" value={propertyDetails.beds} onChange={e => setPropertyDetails(p => ({ ...p, beds: e.target.value }))} min="0" />
                            <input type="number" placeholder="# of Baths" className="w-full rounded-lg p-3" value={propertyDetails.baths} onChange={e => setPropertyDetails(p => ({ ...p, baths: e.target.value }))} min="0" />
                            <input type="number" placeholder="Square Footage (SqFt)" className="w-full rounded-lg p-3" value={propertyDetails.sqft} onChange={e => setPropertyDetails(p => ({ ...p, sqft: e.target.value }))} min="0" />
                        </div>
                    </section>

                    <section id="rehab-items" className="space-y-6">
                        {categories.map(category => (
                            <div key={category} className="bg-[#1E1E1E] p-6 rounded-xl shadow-lg">
                                <h3 className="text-xl font-bold uppercase tracking-tighter mb-4 border-b border-slate-700 pb-2">{category}</h3>
                                {category === 'Bathroom Remodel' && (
                                    <div className="mb-4">
                                        <label htmlFor="baths-to-remodel" className="block text-sm font-medium text-slate-400 mb-1">Number of Bathrooms to Remodel:</label>
                                        <input type="number" id="baths-to-remodel" value={bathsToRemodel} onChange={e => setBathsToRemodel(e.target.value)} min="1" className="w-24 rounded-lg p-2" />
                                    </div>
                                )}
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    {displayItems.filter(item => item.category === category).map(item => {
                                        if (item.type === 'grouped') {
                                            const groupInfo = itemGroups[item.id];
                                            return (
                                                <div key={item.id} className="flex items-center justify-between bg-slate-800 p-3 rounded-lg flex-wrap gap-2">
                                                    <div className="flex items-center space-x-3">
                                                         <input type="checkbox" id={item.id} checked={!!selectedItems[item.id]} onChange={e => handleCheckboxChange(item.id, e.target.checked)} className="h-5 w-5 rounded bg-slate-700 border-slate-600 text-orange-600 focus:ring-orange-500" />
                                                        <label htmlFor={item.id} className="text-slate-300">{item.name}</label>
                                                    </div>
                                                    <select 
                                                        value={selectedQualities[item.id] || groupInfo.default} 
                                                        onChange={e => setSelectedQualities(p => ({...p, [item.id]: e.target.value}))}
                                                        className={`bg-slate-700 border border-slate-600 rounded-md p-1 text-sm text-center transition-all duration-200 ${!selectedItems[item.id] ? 'opacity-0 invisible' : 'opacity-100'}`}
                                                    >
                                                        {groupInfo.options.map(optionId => {
                                                            const optionItem = rehabItemMap[optionId];
                                                            const qualityLabel = optionItem.name.match(/\(([^)]+)\)/)?.[1] || optionItem.name;
                                                            return (
                                                                <option key={optionId} value={optionId}>
                                                                    {qualityLabel} ({formatCurrencySimple(optionItem.cost)})
                                                                </option>
                                                            )
                                                        })}
                                                    </select>
                                                </div>
                                            );
                                        }
                                        
                                        const originalItem = item;
                                        const sqftValue = parseFloat(propertyDetails.sqft) || 0;
                                        return (
                                            <div key={originalItem.id} className="flex items-center justify-between bg-slate-800 p-3 rounded-lg flex-wrap gap-2">
                                                <div className="flex items-center space-x-3">
                                                    <input type="checkbox" id={originalItem.id} checked={!!selectedItems[originalItem.id]} onChange={e => handleCheckboxChange(originalItem.id, e.target.checked)} className="h-5 w-5 rounded bg-slate-700 border-slate-600 text-orange-600 focus:ring-orange-500" />
                                                    <label htmlFor={originalItem.id} className="text-slate-300">{originalItem.name}</label>
                                                </div>
                                                {originalItem.areaType === 'percentage' ? (
                                                    <select value={itemPercentages[originalItem.id] || '100'} onChange={e => setItemPercentages(p => ({...p, [originalItem.id]: e.target.value}))} disabled={!selectedItems[originalItem.id]} className="w-40 rounded-md p-1 text-sm text-center bg-slate-700 border border-slate-600">
                                                        {Array.from({ length: 10 }, (_, i) => (i + 1) * 10).map(p => {
                                                             const calculatedSqft = sqftValue * (p / 100);
                                                             const displayText = sqftValue > 0 ? `${p}% (${Math.round(calculatedSqft)} sqft)` : `${p}% of SQFT`;
                                                             return <option key={p} value={p}>{displayText}</option>
                                                        })}
                                                    </select>
                                                ) : (originalItem.type === 'item' || originalItem.type === 'linear_ft') && (
                                                    <input type="number" value={itemQuantities[originalItem.id] || '1'} onChange={e => setItemQuantities(p => ({...p, [originalItem.id]: e.target.value}))} min="1" placeholder={`# of ${originalItem.label}`} disabled={!selectedItems[originalItem.id]} className="w-24 bg-slate-700 border border-slate-600 rounded-md p-1 text-center" />
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="mt-4 space-y-2">
                                    {customItems[category]?.map((cItem) => (
                                        <div key={cItem.id} className="flex items-center gap-2">
                                            <input type="text" placeholder="Custom Item Name" value={cItem.name} onChange={e => handleCustomItemChange(category, cItem.id, 'name', e.target.value)} className="flex-grow rounded-md p-2" />
                                            <div className="relative">
                                                <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                                                <input type="number" placeholder="Cost" value={cItem.cost} onChange={e => handleCustomItemChange(category, cItem.id, 'cost', e.target.value)} className="w-32 rounded-md p-2 pl-6" />
                                            </div>
                                            <button onClick={() => handleRemoveCustomItem(category, cItem.id)} className="p-2 bg-red-600/50 hover:bg-red-600 rounded-md text-white">&times;</button>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => handleAddCustomItem(category)} className="mt-4 text-sm text-amber-400 hover:text-amber-300">+ Add Custom Rehab Item</button>
                            </div>
                        ))}
                    </section>
                </div>
                <div className="lg:col-span-1 lg:sticky top-24 h-fit">
                    <aside className="bg-[#1E1E1E] p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold uppercase tracking-tighter mb-6 border-b border-slate-700 pb-2">Cost Summary</h2>
                        <div className="space-y-4">
                            <div className="flex justify-between items-center bg-slate-800 p-4 rounded-lg">
                                <span className="text-slate-400">Total Base Rehab Cost</span>
                                <span className="text-2xl font-bold text-white">{formatCurrencySimple(calculationDetails.totalRehabCost)}</span>
                            </div>
                            <div className="flex justify-between items-center bg-slate-800 p-4 rounded-lg">
                                <span className="text-slate-400">Metro Area Adjustment</span>
                                <span className="text-2xl font-bold text-white">{formatCurrencySimple(calculationDetails.rehabEstimation)}</span>
                            </div>
                            <div className="flex justify-between items-center bg-gradient-to-r from-orange-500 to-orange-700 text-white p-4 rounded-lg">
                                <span className="font-semibold">Final Estimate (+10%)</span>
                                <span className="text-3xl font-bold">{formatCurrencySimple(calculationDetails.finalEstimation)}</span>
                            </div>
                        </div>
                        <p className="text-xs text-slate-500 mt-6 text-center">Disclaimer: This tool provides a rough estimate for informational purposes only.</p>
                        
                        <div className="mt-6 border-t border-slate-700 pt-4">
                             <button onClick={() => onAnalysisTransfer(calculationDetails.finalEstimation, { address: propertyDetails.address, sqft: propertyDetails.sqft })} className="w-full bg-gradient-to-r from-green-600 to-green-800 text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity duration-200 mb-4">
                                Go To Profit Analysis &rarr;
                            </button>

                            <h3 className="text-lg font-bold uppercase tracking-tighter mb-3 text-center">Get a Detailed Breakdown</h3>
                            <div className="space-y-3">
                                <input type="email" value={userEmail} onChange={e => setUserEmail(e.target.value)} placeholder="Enter your email address" className="w-full rounded-lg p-3" />
                                <button onClick={handleSendEmail} disabled={isSubmitting} className="w-full bg-gradient-to-r from-yellow-600 to-yellow-800 text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity duration-200">
                                    {isSubmitting ? 'Sending...' : 'Email Me The Full Rehab Budget'}
                                </button>
                                <p className={`text-xs text-center h-4 text-${emailStatus.type}-400`}>{emailStatus.message}</p>
                            </div>
                        </div>
                    </aside>
                </div>
            </main>
        </div>
    );
};

// --- From components/ProfitAnalyzer.tsx ---
const formatCurrency = (value, isPerSqFt = false) => {
    if (isNaN(value) || !isFinite(value)) return '$0';
    const options = { style: 'currency', currency: 'USD', minimumFractionDigits: isPerSqFt ? 2 : 0, maximumFractionDigits: isPerSqFt ? 2 : 0 };
    return value.toLocaleString('en-US', options);
};

const getDealMetrics = (arv, purchasePrice, rehabCosts, financingParams, sqft, extraCosts) => {
    const { ltv, interestRate, holdingPeriod } = financingParams;
    const sellingCosts = arv * 0.06;
    const closingCosts = purchasePrice * 0.05;
    const totalCostBasis = purchasePrice + rehabCosts;
    const loanAmount = totalCostBasis * (ltv / 100);
    const financingCosts = loanAmount * (interestRate / 100 / 12) * holdingPeriod;
    const totalExtraCosts = extraCosts.reduce((acc, cost) => acc + (parseFloat(cost.amount) || 0), 0);
    const totalHoldingCosts = sellingCosts + financingCosts + closingCosts + totalExtraCosts;
    const totalProjectCost = purchasePrice + rehabCosts + totalHoldingCosts;
    const netProfit = arv - totalProjectCost;
    const downPayment = totalCostBasis - loanAmount;
    const acquisitionCost = closingCosts + downPayment;
    const roi = acquisitionCost > 0 ? (netProfit / acquisitionCost) * 100 : Infinity;
    const costBasisOfArv = arv > 0 ? (totalCostBasis / arv) * 100 : 0;
    const profitMargin = arv > 0 ? (netProfit / arv) * 100 : 0;
    const arvPerSqft = sqft > 0 ? arv / sqft : 0;
    const purchasePricePerSqft = sqft > 0 ? purchasePrice / sqft : 0;
    const rehabPerSqft = sqft > 0 ? rehabCosts / sqft : 0;
    const loanToArv = arv > 0 ? (loanAmount / arv) * 100 : 0;
    return { arv, purchasePrice, rehabCosts, sellingCosts, closingCosts, loanAmount, financingCosts, totalHoldingCosts, totalProjectCost, netProfit, acquisitionCost, roi, downPayment, totalCostBasis, ltv, costBasisOfArv, profitMargin, arvPerSqft, purchasePricePerSqft, rehabPerSqft, totalExtraCosts, loanToArv };
};

const ProfitAnalyzer = ({ initialRehabCost, initialPropertyDetails }) => {
    const [inputs, setInputs] = useState({
        propertyAddress: initialPropertyDetails.address || '',
        sqft: initialPropertyDetails.sqft || '',
        arv: '515000',
        purchasePrice: '345000',
        rehabCosts: initialRehabCost > 0 ? String(Math.round(initialRehabCost)) : '45000',
        targetProfit: '51500',
        ltv: '75',
        interestRate: '12',
        holdingPeriod: '6',
        userEmail: '',
    });
    const [extraCosts, setExtraCosts] = useState([]);
    
    useEffect(() => {
        setInputs(prev => ({
            ...prev,
            rehabCosts: initialRehabCost > 0 ? String(Math.round(initialRehabCost)) : prev.rehabCosts,
            propertyAddress: initialPropertyDetails.address || prev.propertyAddress,
            sqft: initialPropertyDetails.sqft || prev.sqft,
        }));
    }, [initialRehabCost, initialPropertyDetails]);

    const [uiVisibility, setUiVisibility] = useState({ acquisitionCalc: false, loanCalc: false });
    const [submitStatus, setSubmitStatus] = useState({ message: '', type: '' });
    const [isSubmitting, setIsSubmitting] = useState(false);

    const handleInputChange = (e) => {
        const { id, value } = e.target;
        setInputs(prev => ({ ...prev, [id]: value }));
    };

    const handleAddExtraCost = () => {
        setExtraCosts(prev => [...prev, { id: Date.now(), name: '', amount: '' }]);
    };

    const handleExtraCostChange = (id, field, value) => {
        setExtraCosts(prev => prev.map(cost => cost.id === id ? { ...cost, [field]: value } : cost));
    };

    const handleRemoveExtraCost = (id) => {
        setExtraCosts(prev => prev.filter(cost => cost.id !== id));
    };
    
    useEffect(() => {
        const arv = parseFloat(inputs.arv) || 0;
        const percentageProfit = arv * 0.10;
        const calculatedTarget = Math.min(100000, Math.max(30000, percentageProfit));
        setInputs(prev => ({...prev, targetProfit: String(Math.round(calculatedTarget))}));
    }, [inputs.arv]);

    const metrics = useMemo(() => {
        const sqft = parseFloat(inputs.sqft) || 0;
        const arv = parseFloat(inputs.arv) || 0;
        const purchasePrice = parseFloat(inputs.purchasePrice) || 0;
        const rehabCosts = parseFloat(inputs.rehabCosts) || 0;
        const financingParams = {
            ltv: parseFloat(inputs.ltv) || 0,
            interestRate: parseFloat(inputs.interestRate) || 0,
            holdingPeriod: parseFloat(inputs.holdingPeriod) || 0
        };
        return getDealMetrics(arv, purchasePrice, rehabCosts, financingParams, sqft, extraCosts);
    }, [inputs, extraCosts]);

    const profitTable = useMemo(() => {
        const sqft = parseFloat(inputs.sqft) || 0;
        const targetProfit = parseFloat(inputs.targetProfit) || 0;
        const basePurchase = metrics.purchasePrice;
        const baseRehab = metrics.rehabCosts;
        const purchaseIncrement = basePurchase * 0.03 || 5000;
        const rehabIncrement = baseRehab * 0.03 || 1000;
        const financingParams = { ltv: metrics.ltv, interestRate: parseFloat(inputs.interestRate), holdingPeriod: parseFloat(inputs.holdingPeriod) };

        const rehabHeaders = Array.from({ length: 11 }, (_, i) => baseRehab + ((i - 5) * rehabIncrement));
        const purchaseRows = Array.from({ length: 6 }, (_, j) => basePurchase - (j * purchaseIncrement));

        return (
            <table id="profit_table" className="w-full text-sm border-collapse border border-slate-700">
                <thead>
                    <tr>
                        <th className="border border-slate-600 font-bold">PP &darr; | Rehab &rarr;</th>
                        {rehabHeaders.map(rh => <th key={rh} className="border border-slate-600">{formatCurrency(rh)}</th>)}
                    </tr>
                </thead>
                <tbody>
                    {purchaseRows.map(pr => (
                        <tr key={pr}>
                            <th className="bg-slate-800 border border-slate-600">{formatCurrency(pr)}</th>
                            {rehabHeaders.map((rh, rhIndex) => {
                                const cellMetrics = getDealMetrics(metrics.arv, pr, rh, financingParams, sqft, extraCosts);
                                const inRangeClass = cellMetrics.netProfit >= targetProfit ? 'in-range' : '';
                                const currentDealClass = (rhIndex === 5 && pr === basePurchase) ? 'current-deal' : '';
                                return <td key={rh} className={`${inRangeClass} ${currentDealClass} border border-slate-700`}>{formatCurrency(cellMetrics.netProfit)}</td>;
                            })}
                        </tr>
                    ))}
                </tbody>
            </table>
        );
    }, [metrics, inputs.targetProfit, inputs.interestRate, inputs.holdingPeriod, extraCosts]);

    const getProfitTableData = useCallback(() => {
        const sqft = parseFloat(inputs.sqft) || 0;
        const financingParams = { ltv: metrics.ltv, interestRate: parseFloat(inputs.interestRate), holdingPeriod: parseFloat(inputs.holdingPeriod) };
        const basePurchase = metrics.purchasePrice; const baseRehab = metrics.rehabCosts; const purchaseIncrement = basePurchase * 0.03 || 5000; const rehabIncrement = baseRehab * 0.03 || 1000;
        const headers = ['Purchase Price \\ Rehab Cost', ...Array.from({ length: 11 }, (_, i) => formatCurrency(baseRehab + ((i - 5) * rehabIncrement)))];
        const rows = Array.from({ length: 6 }, (_, j) => {
            const purchaseVal = basePurchase - (j * purchaseIncrement);
            const rowData = { purchasePrice: formatCurrency(purchaseVal), profits: {} };
            headers.slice(1).forEach((header, i) => {
                const rehabVal = baseRehab + ((i - 5) * rehabIncrement);
                const cellMetrics = getDealMetrics(metrics.arv, purchaseVal, rehabVal, financingParams, sqft, extraCosts);
                rowData.profits[header] = formatCurrency(cellMetrics.netProfit);
            });
            return rowData;
        });
        return { headers, rows };
    }, [metrics, inputs.sqft, inputs.interestRate, inputs.holdingPeriod, extraCosts]);

    const sendToWebhook = async () => {
        const email = inputs.userEmail;
        if (!email || !email.includes('@')) {
            setSubmitStatus({ message: 'Please enter a valid email address.', type: 'red' });
            return;
        }
        setIsSubmitting(true);
        setSubmitStatus({ message: 'Sending...', type: 'gray' });

        const tableData = getProfitTableData();
        const payload = {
            email,
            report: {
                propertyDetails: { address: inputs.propertyAddress || 'N/A', sqft: inputs.sqft || 'N/A' },
                dealInputs: { arv: formatCurrency(metrics.arv), purchasePrice: formatCurrency(metrics.purchasePrice), rehabCosts: formatCurrency(metrics.rehabCosts), minTargetProfit: formatCurrency(parseFloat(inputs.targetProfit)) },
                financingAssumptions: { ltv: `${inputs.ltv}%`, interestRate: `${inputs.interestRate}%`, holdingPeriod: `${inputs.holdingPeriod} months` },
                profitAnalysis: {
                    netProfit: formatCurrency(metrics.netProfit),
                    roi: isFinite(metrics.roi) ? `${metrics.roi.toFixed(1)}%` : 'N/A',
                    profitMargin: isFinite(metrics.profitMargin) ? `${metrics.profitMargin.toFixed(1)}%` : 'N/A',
                    upfrontAcquisitionCost: formatCurrency(metrics.acquisitionCost),
                    estLoanAmount: formatCurrency(metrics.loanAmount),
                    costBasisVsArv: `${metrics.costBasisOfArv.toFixed(1)}%`,
                    arvPerSqft: metrics.arvPerSqft > 0 ? formatCurrency(metrics.arvPerSqft, true) : 'N/A',
                    purchasePricePerSqft: metrics.purchasePricePerSqft > 0 ? formatCurrency(metrics.purchasePricePerSqft, true) : 'N/A',
                    rehabPerSqft: metrics.rehabPerSqft > 0 ? formatCurrency(metrics.rehabPerSqft, true) : 'N/A'
                },
                sensitivityAnalysis: tableData,
            }
        };

        try {
            const response = await fetch('https://hook.us2.make.com/toloqfcv3e31we94yhbvugmvq5n6glof', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if(response.ok) {
                setSubmitStatus({ message: 'Deal report sent successfully!', type: 'green' });
            } else {
                throw new Error('Server responded with an error.');
            }
        } catch (error) {
            console.error('Webhook submission failed:', error);
            setSubmitStatus({ message: 'Submission failed. Please try again.', type: 'red' });
        } finally {
            setIsSubmitting(false);
        }
    };

    return (
        <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
            <div className="w-full max-w-7xl mx-auto">
                <header className="text-center mb-10 pt-8 sm:pt-0">
                    <h1 className="text-3xl sm:text-4xl lg:text-5xl font-black uppercase tracking-tight text-white">
                        Fix & Flip Deal Analyzer
                    </h1>
                    <p className="mt-2 text-lg text-slate-400">
                        Make decisions with numbers, not emotion. Adjust the sliders to analyze your deal potential.
                    </p>
                </header>

                <main className="grid grid-cols-1 lg:grid-cols-5 gap-8">
                    <div className="lg:col-span-2 space-y-6">
                        {/* Deal Inputs */}
                        <div className="bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                            <h2 className="text-2xl font-bold text-white mb-6 flex items-center">
                                <SlidersHorizontal className="mr-3 text-amber-400" /> Deal Inputs
                            </h2>
                            <div className="space-y-4 mb-6 border-b border-slate-700 pb-6">
                                <div>
                                    <label htmlFor="propertyAddress" className="font-semibold text-white">Property Address</label>
                                    <input type="text" id="propertyAddress" value={inputs.propertyAddress} onChange={handleInputChange} className="w-full p-2 rounded-md mt-1" placeholder="e.g., 123 Main St, Anytown, USA" />
                                </div>
                                <div>
                                    <label htmlFor="sqft" className="font-semibold text-white">Square Footage (SQFT)</label>
                                    <input type="number" id="sqft" value={inputs.sqft} onChange={handleInputChange} className="w-full p-2 rounded-md mt-1" placeholder="e.g., 1500" />
                                </div>
                            </div>
                            
                            {/* Sliders */}
                            {[
                                { id: 'arv', label: 'After-Repair Value (ARV)', min: 50000, max: 2000000, value: inputs.arv, perSqFt: metrics.arvPerSqft },
                                { id: 'purchasePrice', label: 'Purchase Price', min: 10000, max: 1500000, value: inputs.purchasePrice, perSqFt: metrics.purchasePricePerSqft },
                                { id: 'rehabCosts', label: 'Rehab Costs', min: 0, max: 500000, value: inputs.rehabCosts, perSqFt: metrics.rehabPerSqft },
                            ].map(slider => (
                                <div key={slider.id} className="space-y-3 mb-6">
                                    <div className="flex justify-between items-baseline">
                                        <label htmlFor={slider.id} className="font-semibold text-white">{slider.label}</label>
                                        <div className="flex items-center gap-3">
                                            <span className="text-sm text-slate-400 whitespace-nowrap">{metrics.arvPerSqft > 0 ? `(${formatCurrency(slider.perSqFt, true)}/sqft)` : ''}</span>
                                            <input type="number" id={slider.id} value={slider.value} onChange={handleInputChange} className="w-32 text-right p-1 rounded-md" />
                                        </div>
                                    </div>
                                    <input type="range" id={`${slider.id}_slider`} min={slider.min} max={slider.max} value={slider.value} onChange={e => setInputs(p => ({ ...p, [slider.id]: e.target.value }))} className="w-full" />
                                </div>
                            ))}

                            <div className="space-y-3">
                                <div className="flex justify-between items-center">
                                    <label htmlFor="targetProfit" className="font-semibold text-white flex items-center">
                                        Min. Target Profit
                                        <span title="Auto-calculated as the greater of $30k or 10% of ARV (max $100k), but you can override it.">
                                            <Info className="w-4 h-4 ml-2 text-slate-400 cursor-pointer" />
                                        </span>
                                    </label>
                                    <div className="relative">
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                                        <input type="number" id="targetProfit" value={inputs.targetProfit} onChange={handleInputChange} className="w-32 text-right p-1 rounded-md pl-6" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Financing Assumptions */}
                        <div className="bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                             <h2 className="text-2xl font-bold text-white mb-6 flex items-center">
                                <Landmark className="mr-3 text-amber-400" /> Financing Assumptions
                            </h2>
                            <div className="space-y-4">
                                {[
                                    {id: 'ltv', label: 'Loan to Total Cost (%)'},
                                    {id: 'interestRate', label: 'Interest Rate (%)'},
                                    {id: 'holdingPeriod', label: 'Holding Period (Months)'},
                                ].map(fin => (
                                    <div key={fin.id} className="flex justify-between items-center">
                                        <label htmlFor={fin.id} className="font-medium text-slate-300">{fin.label}</label>
                                        <input type="number" id={fin.id} value={inputs[fin.id]} onChange={handleInputChange} className="w-24 text-right p-1 rounded-md" />
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    
                    {/* Profit Analysis */}
                    <div className="lg:col-span-3">
                        <div className="bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                            <h2 className="text-2xl font-bold text-white mb-6 flex items-center">
                               <BarChart2 className="mr-3 text-amber-400" /> Profit Analysis
                            </h2>
                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                                <div className={`p-4 rounded-lg border transition-all duration-300 ${metrics.netProfit >= parseFloat(inputs.targetProfit) ? 'bg-green-500/20 border-green-500' : 'bg-red-500/20 border-red-500'}`}>
                                    <p className="text-sm font-medium text-slate-400">NET PROFIT</p>
                                    <p className="text-4xl font-bold">{formatCurrency(metrics.netProfit)}</p>
                                </div>
                                <div className="p-4 rounded-lg bg-black/20 border border-slate-700">
                                    <p className="text-sm font-medium text-slate-400">RETURN ON INVESTMENT (ROI)</p>
                                    <p className="text-4xl font-bold gradient-text">{isFinite(metrics.roi) ? `${metrics.roi.toFixed(1)}%` : 'N/A'}</p>
                                </div>
                                 <div className="p-4 rounded-lg bg-black/20 border border-slate-700">
                                    <p className="text-sm font-medium text-slate-400">PROFIT MARGIN (% OF ARV)</p>
                                    <p className="text-4xl font-bold gradient-text">{isFinite(metrics.profitMargin) ? `${metrics.profitMargin.toFixed(1)}%` : 'N/A'}</p>
                                </div>
                                <div className="p-4 rounded-lg bg-black/20 border border-slate-700">
                                    <div className="flex items-center justify-between">
                                        <p className="text-sm font-medium text-slate-400">UPFRONT ACQUISITION COST</p>
                                        <ChevronDown onClick={() => setUiVisibility(p => ({...p, acquisitionCalc: !p.acquisitionCalc}))} className={`w-5 h-5 text-slate-500 cursor-pointer transition-transform ${uiVisibility.acquisitionCalc ? 'rotate-180' : ''}`} />
                                    </div>
                                    <p className="text-2xl font-semibold">{formatCurrency(metrics.acquisitionCost)}</p>
                                    <div className={`${uiVisibility.acquisitionCalc ? '' : 'hidden'} mt-2 text-xs text-slate-400 bg-slate-800 p-2 rounded`}>Down Payment: {formatCurrency(metrics.downPayment)}<br/>+ Closing Costs: {formatCurrency(metrics.closingCosts)}</div>
                                </div>
                                <div className="p-4 rounded-lg bg-black/20 border border-slate-700">
                                    <div className="flex items-center justify-between">
                                        <p className="text-sm font-medium text-slate-400">EST. LOAN AMOUNT</p>
                                        <ChevronDown onClick={() => setUiVisibility(p => ({...p, loanCalc: !p.loanCalc}))} className={`w-5 h-5 text-slate-500 cursor-pointer transition-transform ${uiVisibility.loanCalc ? 'rotate-180' : ''}`} />
                                    </div>
                                    <p className="text-2xl font-semibold">{formatCurrency(metrics.loanAmount)}</p>
                                    <div className="text-xs text-slate-400 mt-1 space-y-0.5">
                                        <div>Loan / Total Cost: <span className="font-semibold text-white">{metrics.ltv}%</span></div>
                                        <div>Loan / ARV: <span className="font-semibold text-white">{metrics.loanToArv.toFixed(1)}%</span></div>
                                    </div>
                                    <div className={`${uiVisibility.loanCalc ? '' : 'hidden'} mt-2 text-xs text-slate-400 bg-slate-800 p-2 rounded`}>(Purchase + Rehab) * LTV<br/>({formatCurrency(metrics.purchasePrice)} + {formatCurrency(metrics.rehabCosts)}) * {metrics.ltv}%</div>
                                </div>
                                <div className="p-4 rounded-lg bg-black/20 border border-slate-700">
                                    <p className="text-sm font-medium text-slate-400">PURCHASE + REHAB % OF ARV</p>
                                    <p className={`text-4xl font-bold ${metrics.costBasisOfArv > 75 ? 'text-red-400' : 'text-green-400'}`}>{metrics.costBasisOfArv.toFixed(1)}%</p>
                                </div>
                            </div>
                            <div>
                                <h3 className="font-semibold text-white mb-3">Deal Breakdown</h3>
                                <div className="space-y-2 text-slate-300">
                                    <div className="flex justify-between p-2 rounded bg-black/20"><span>After-Repair Value (ARV)</span><span className="font-bold text-white">{formatCurrency(metrics.arv)}</span></div>
                                    <div className="flex justify-between p-2 rounded bg-black/20 text-red-400"><span>(-) Total Project Costs</span><span className="font-semibold">{formatCurrency(metrics.totalProjectCost)}</span></div>
                                    <div className="ml-4 border-l-2 border-slate-700 pl-4 space-y-2 py-2">
                                        <div className="flex justify-between text-sm"><span>Purchase Price</span><span>{formatCurrency(metrics.purchasePrice)}</span></div>
                                        <div className="flex justify-between text-sm"><span>Rehab Costs</span><span>{formatCurrency(metrics.rehabCosts)}</span></div>
                                        <div className="flex justify-between text-sm group"><span>Holding Costs</span><span className="font-semibold">{formatCurrency(metrics.totalHoldingCosts)}</span></div>
                                        <div className="ml-4 border-l-2 border-slate-600 pl-4 space-y-1 py-1">
                                            <div className="flex justify-between text-xs"><span>Selling Costs (6% of ARV)</span><span>{formatCurrency(metrics.sellingCosts)}</span></div>
                                            <div className="flex justify-between text-xs"><span>Financing Costs</span><span>{formatCurrency(metrics.financingCosts)}</span></div>
                                            <div className="flex justify-between text-xs"><span>Closing Costs (5% of Purchase Price)</span><span>{formatCurrency(metrics.closingCosts)}</span></div>
                                            {extraCosts.map(cost => (
                                                <div key={cost.id} className="flex items-center gap-2 text-xs py-1">
                                                    <input
                                                        type="text"
                                                        placeholder="Extra cost name..."
                                                        value={cost.name}
                                                        onChange={(e) => handleExtraCostChange(cost.id, 'name', e.target.value)}
                                                        className="bg-slate-800/50 rounded p-1 w-full text-slate-300 text-xs border border-slate-700"
                                                    />
                                                    <div className="relative flex-shrink-0">
                                                        <span className="absolute left-2 top-1/2 -translate-y-1/2 text-slate-500 text-xs">$</span>
                                                        <input
                                                            type="number"
                                                            placeholder="Amount"
                                                            value={cost.amount}
                                                            onChange={(e) => handleExtraCostChange(cost.id, 'amount', e.target.value)}
                                                            className="bg-slate-800/50 rounded p-1 w-24 pl-4 text-slate-300 text-xs border border-slate-700"
                                                        />
                                                    </div>
                                                    <button onClick={() => handleRemoveExtraCost(cost.id)} className="p-1.5 leading-none bg-red-600/50 hover:bg-red-600 rounded-md text-white flex-shrink-0">&times;</button>
                                                </div>
                                            ))}
                                            <button onClick={handleAddExtraCost} className="text-xs text-amber-400 hover:text-amber-300 mt-1">+ Add Extra Cost Item</button>
                                        </div>
                                    </div>
                                    <div className="flex justify-between p-2 rounded bg-green-500/10 text-green-300 border-t-2 border-green-500/30">
                                        <span className="font-bold">(=) NET PROFIT</span>
                                        <span className="font-bold">{formatCurrency(metrics.netProfit)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
                <section className="mt-8 bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                    <h2 className="text-2xl font-bold text-white mb-2 flex items-center">
                        <Table className="mr-3 text-amber-400" /> Profit Sensitivity Analysis
                    </h2>
                    <p className="text-sm text-slate-400 mb-4">The table below shows how Net Profit changes with different Purchase Prices and Rehab Costs. Green cells meet or exceed your Target Profit.</p>
                    <div id="profit_table_container" className="rounded-lg overflow-x-auto">
                        {profitTable}
                    </div>
                </section>

                <section id="submit_deal_section" className="mt-8 bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                    <h2 className="text-2xl font-bold text-white mb-4 flex items-center">
                        <Mail className="mr-3 text-amber-400" /> Get Your Deal Report
                    </h2>
                    <p className="text-sm text-slate-400 mb-4">Enter your email below to send a copy of this deal analysis to your inbox.</p>
                    <div className="flex flex-col sm:flex-row gap-4 items-center">
                        <input type="email" id="userEmail" value={inputs.userEmail} onChange={handleInputChange} placeholder="Enter your email address..." className="flex-grow w-full p-3 rounded-md focus:ring-2 focus:ring-amber-500 focus:outline-none transition" />
                        <button onClick={sendToWebhook} disabled={isSubmitting} className="w-full sm:w-auto bg-gradient-to-r from-orange-600 to-orange-800 hover:from-orange-700 hover:to-orange-900 text-white font-bold py-3 px-6 rounded-md transition-all duration-300 flex items-center justify-center">
                           <span className={isSubmitting ? 'hidden' : ''}>Send Me The Report</span>
                           {isSubmitting && <span className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></span>}
                        </button>
                    </div>
                    <p className={`text-sm mt-3 h-4 text-${submitStatus.type}-400`}>{submitStatus.message}</p>
                </section>
            </div>
        </div>
    );
};

// --- From components/SubmitDeal.tsx ---
const SubmitDeal = () => {
    const formUrl = "https://shy-spike-7b2.notion.site/ebd/28041616c38e80ffb2cfea0c8d6ce778";
    return (
        <div className="container mx-auto p-4 md:p-8 text-center flex flex-col items-center justify-center">
            <header className="mb-8 w-full max-w-4xl">
                <h1 className="text-4xl md:text-5xl font-extrabold uppercase tracking-tighter text-white">Submit Your Deal</h1>
                <p className="text-slate-400 mt-2 mx-auto">Complete the form below to submit your potential fix-and-flip project for review by our team.</p>
            </header>
            <div className="w-full max-w-4xl bg-slate-900/50 p-4 rounded-2xl border border-slate-700">
                <iframe 
                    src={formUrl}
                    className="w-full h-[80vh] max-h-[900px] rounded-lg"
                    style={{ border: 'none' }}
                    frameBorder="0" 
                    allowFullScreen 
                    title="Deal Submission Form"
                />
            </div>
            <div className="mt-4 text-xs text-slate-500 max-w-4xl text-center p-2 bg-slate-800/30 rounded-md">
                <strong>Note:</strong> If the form above appears blank, it&apos;s likely due to browser security settings when opening this file directly from your computer. For the form to work correctly, this file should be viewed via a web server (e.g., by hosting it on GitHub Pages or running a simple local server).
            </div>
        </div>
    );
};


// --- From components/Header.tsx ---
const Header = ({ currentView, setCurrentView, onAnalysisTransfer }) => {
    const navItems = [
        { view: View.RehabEstimator, label: 'Rehab Estimator', shortLabel: 'REHAB', icon: Construction, iconColor: 'text-amber-400' },
        { view: View.ProfitAnalysis, label: 'Profit Analysis', shortLabel: 'PROFIT', icon: TrendingUp, iconColor: 'text-emerald-400' },
        { view: View.SubmitDeal, label: 'Submit Deal', shortLabel: 'SUBMIT', icon: Inbox, iconColor: 'text-sky-400' },
    ];

    return (
        <nav className="bg-slate-900/50 py-3 border-b border-slate-700 sticky top-0 z-50 backdrop-blur-sm">
            <div className="container mx-auto flex flex-row justify-between items-center gap-3 px-4">
                <a href="https://learn.theunshakableinvestor.com" target="_blank" rel="noopener noreferrer" className="flex-shrink-0">
                    <img src="https://storage.googleapis.com/msgsndr/zQh0YM3EIsWgcjMDTSSC/media/68c95d8f7505d3a75a7fabd2.png" alt="Unshakable Investor Logo" className="h-8 w-auto" />
                </a>

                {/* Desktop Nav */}
                <div className="hidden sm:flex items-center space-x-4" role="tablist" aria-label="Tool navigation">
                    {navItems.map(item => (
                        <button
                            key={item.view}
                            onClick={() => setCurrentView(item.view)}
                            className={`nav-button ${currentView === item.view ? 'active' : ''} bg-slate-800 text-white hover:bg-slate-700 px-3 py-2 rounded-md text-sm font-bold uppercase tracking-wider text-center transition-colors flex items-center gap-2`}
                            role="tab"
                            aria-selected={currentView === item.view}
                            aria-controls={item.view}
                        >
                            <item.icon className={`h-4 w-4 ${item.iconColor}`} />
                            <span>{item.label}</span>
                        </button>
                    ))}
                </div>

                {/* Mobile Nav */}
                <div className="sm:hidden flex items-center space-x-2" role="tablist" aria-label="Tool navigation">
                    {navItems.map(item => (
                        <button
                            key={item.view}
                            onClick={() => setCurrentView(item.view)}
                            className={`nav-button ${currentView === item.view ? 'active' : ''} bg-slate-800 text-white hover:bg-slate-700 px-3 py-2 rounded-md text-xs font-bold uppercase tracking-wider text-center transition-colors flex items-center gap-1.5`}
                            role="tab"
                            aria-selected={currentView === item.view}
                            aria-controls={item.view}
                        >
                            <item.icon className={`h-4 w-4 ${item.iconColor}`} />
                            <span>{item.shortLabel}</span>
                        </button>
                    ))}
                </div>
            </div>
        </nav>
    );
};


// --- From App.tsx ---
const App = () => {
    const [currentView, setCurrentView] = useState(View.RehabEstimator);
    const [rehabCost, setRehabCost] = useState(0);
    const [propertyDetails, setPropertyDetails] = useState({ address: '', sqft: '' });

    const handleViewChange = useCallback((view) => {
        setCurrentView(view);
    }, []);

    const handleAnalysisTransfer = (cost, details) => {
        setRehabCost(cost);
        setPropertyDetails(details);
        setCurrentView(View.ProfitAnalysis);
    };

    return (
        <>
            <Header currentView={currentView} setCurrentView={handleViewChange} onAnalysisTransfer={() => {
                if (currentView === View.RehabEstimator) {
                     setCurrentView(View.ProfitAnalysis);
                }
            }} />
            <main id="app-container">
                <div style={{ display: currentView === View.RehabEstimator ? 'block' : 'none' }}>
                    <RehabEstimator onAnalysisTransfer={handleAnalysisTransfer} />
                </div>
                <div style={{ display: currentView === View.ProfitAnalysis ? 'block' : 'none' }}>
                    <ProfitAnalyzer initialRehabCost={rehabCost} initialPropertyDetails={propertyDetails} />
                </div>
                 <div style={{ display: currentView === View.SubmitDeal ? 'block' : 'none' }}>
                    <SubmitDeal />
                </div>
            </main>
        </>
    );
};

// --- From index.tsx ---
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

</script>
<script type="module" src="/index.tsx"></script>
</body>
</html>