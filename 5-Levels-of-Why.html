<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IGNITE | 5 Levels of Why</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    
    <!-- Google Fonts: Inter (Mandatory Brand Font) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD - Robust Loading) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      :root {
        --bg-dark: #0A0A0A;
        --gold-primary: #D4AF37;
        --gold-light: #E5C76B;
        --fire-start: #C84A00;
        --fire-end: #FF6A00;
      }
      body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-dark);
        color: white;
        margin: 0;
        overflow: hidden;
      }

      /* --- Cinematic Background Animation --- */
      .ember-bg {
        background: radial-gradient(circle at 50% 50%, #1a1005 0%, #0A0A0A 60%);
        background-size: 200% 200%;
        animation: breathe 8s ease-in-out infinite;
      }
      @keyframes breathe {
        0% { background-position: 50% 50%; }
        50% { background-position: 50% 60%; }
        100% { background-position: 50% 50%; }
      }
      
      .pulse-glow {
        animation: pulse-gold 3s infinite;
      }
      @keyframes pulse-gold {
        0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.2); }
        70% { box-shadow: 0 0 0 20px rgba(212, 175, 55, 0); }
        100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
      }

      /* Error Display */
      #debug-error {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 9999;
        color: #ff4444; padding: 2rem;
        font-family: monospace;
        white-space: pre-wrap;
      }
      
      /* Scrollbars */
      .custom-scrollbar::-webkit-scrollbar { width: 6px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: var(--bg-dark); }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
      
      .btn-primary {
        background: linear-gradient(135deg, var(--gold-primary), var(--fire-end));
        color: white;
        text-transform: uppercase;
        font-weight: 800;
        letter-spacing: 0.1em;
        border: none;
        transition: all 0.3s ease;
      }
      .btn-primary:hover:not(:disabled) {
        box-shadow: 0 0 25px rgba(212, 175, 55, 0.4);
        transform: translateY(-2px) scale(1.02);
      }
      
      @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      .animate-fade-in-up { animation: fade-in-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
      
      .glass-panel {
        background: rgba(26, 26, 26, 0.8);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
    </style>
</head>
<body>
    <div id="debug-error"></div>
    <div id="root"></div>

    <script>
      // Global Error Handler
      window.onerror = function(msg, url, line, col, error) {
        const div = document.getElementById('debug-error');
        div.style.display = 'block';
        div.innerHTML = `CRITICAL SYSTEM FAILURE:\n\n${msg}\n\nLine: ${line}`;
        return false;
      };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef, Fragment } = React;
        const { createRoot } = ReactDOM;

        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        // !!! OPERATOR: PASTE YOUR API KEY HERE !!!
        const HARDCODED_API_KEY = "AIzaSyDl5jNifT8f3qgFOiGpt3BpV92fZc4UntY"; 
        
        // Direct REST Endpoint (No SDK needed)
        const GEMINI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite-preview-02-05:generateContent";

        // ==========================================
        // DIRECT API SERVICE
        // ==========================================
        
        const callGemini = async (prompt, isJson = false) => {
            const key = HARDCODED_API_KEY;
            
            if (!key || key === "YOUR_API_KEY_HERE") {
                const err = "API Key is missing. Please edit index.html line 88.";
                return isJson ? { whyStatement: err, emotionalCore: "Configuration Required" } : err;
            }

            try {
                const response = await fetch(`${GEMINI_URL}?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: isJson ? { responseMimeType: "application/json" } : {}
                    })
                });

                if (!response.ok) {
                    const err = await response.text();
                    if (response.status === 400) throw new Error("INVALID API KEY. Check your configuration.");
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response generated.";
                return isJson ? JSON.parse(text) : text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return isJson ? { whyStatement: `Error: ${error.message}`, emotionalCore: "System Offline" } : `Error: ${error.message}`;
            }
        };

        const generateNextQuestion = async (history, currentLevel) => {
            const historyText = history.map(h => `Level ${h.level} A: ${h.answer}`).join('\n');
            const lastAnswer = history[history.length - 1].answer;
            
            let systemPrompt = `ROLE: Socratic Coach (Toby Potter). TONE: Direct, intense, digging for truth. LEVEL: ${currentLevel}. Answer with ONLY the question. `;
            
            if (currentLevel === 2) systemPrompt += `Reflect on "${lastAnswer}". Ask what MECHANICAL/FUNCTIONAL outcome breaks if they don't get this. What becomes impossible?`;
            else if (currentLevel === 3) systemPrompt += `Take answer "${lastAnswer}". Ask for the EMOTION behind it. Fear? Shame? Pride? What fuel is in the tank?`;
            else if (currentLevel === 4) systemPrompt += `Take answer "${lastAnswer}". Ask what this says about their IDENTITY. Who are they afraid of becoming?`;
            else if (currentLevel === 5) systemPrompt += `Take answer "${lastAnswer}". Ask about the ROOT ORIGIN/VOW. When did this start?`;

            return await callGemini(systemPrompt + `\nUSER HISTORY:\n${historyText}\n\nUSER LATEST ANSWER: "${lastAnswer}"`);
        };

        const generateSynthesis = async (history) => {
            const historyText = history.map(h => `L${h.level}: ${h.answer}`).join('\n');
            const prompt = `ROLE: Master Psychologist (Toby Potter). Analyze session:\n${historyText}\n\nReturn JSON: { "whyStatement": "150 word summary connecting L1 to L5. Use 'You' language. Be firm but encouraging.", "emotionalCore": "1 sentence hard truth/manifesto" }`;
            return await callGemini(prompt, true);
        };

        // ==========================================
        // UI DATA (SVG & Content)
        // ==========================================

        const LEVEL_GUIDE_DATA = [
          {
            level: 1,
            title: "What do you want?",
            subtitle: "Describe the specific result or outcome you are chasing.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                <defs>
                  <linearGradient id="skyGrad" x1="0" y1="0" x2="0" y2="250"><stop offset="0%" stopColor="#0D0D0D" /><stop offset="100%" stopColor="#1A1A1A" /></linearGradient>
                  <linearGradient id="waterGrad" x1="0" y1="250" x2="0" y2="500"><stop offset="0%" stopColor="#1A1A1A" stopOpacity="0.8" /><stop offset="100%" stopColor="#000000" stopOpacity="0.95" /></linearGradient>
                  <linearGradient id="iceLight" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor="#FFFFFF" /><stop offset="100%" stopColor="#D4AF37" /></linearGradient>
                  <linearGradient id="iceDark" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor="#333333" /><stop offset="100%" stopColor="#111111" /></linearGradient>
                  <filter id="glow" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="5" result="blur" /><feComposite in="SourceGraphic" in2="blur" operator="over" /></filter>
                </defs>
                <rect width="800" height="250" fill="url(#skyGrad)" />
                <rect y="250" width="800" height="250" fill="url(#waterGrad)" />
                <line x1="0" y1="250" x2="800" y2="250" stroke="#D4AF37" strokeWidth="1" strokeDasharray="4 4" opacity="0.5" />
                <text x="780" y="240" fill="#D4AF37" fontSize="12" fontFamily="monospace" textAnchor="end" opacity="0.8">WATERLINE [VISIBILITY THRESHOLD]</text>
                <g filter="url(#glow)">
                   <path d="M400 100 L460 250 L340 250 Z" fill="url(#iceLight)" stroke="#D4AF37" strokeWidth="2" />
                   <path d="M400 100 L430 250 L460 250 Z" fill="#B8962F" opacity="0.5" />
                </g>
                <path d="M340 250 L300 350 L350 450 L450 480 L500 380 L460 250 Z" fill="url(#iceDark)" stroke="#444" strokeWidth="1" opacity="0.8" />
                <g transform="translate(500, 120)">
                    <line x1="0" y1="0" x2="-40" y2="20" stroke="#D4AF37" />
                    <circle cx="0" cy="0" r="3" fill="#D4AF37" />
                    <text x="10" y="4" fill="#FFFFFF" fontSize="14" fontWeight="bold">SYMPTOM</text>
                </g>
                <g transform="translate(250, 350)">
                    <line x1="0" y1="0" x2="50" y2="0" stroke="#666" />
                    <circle cx="0" cy="0" r="3" fill="#666" />
                    <text x="-10" y="4" fill="#666" fontSize="14" textAnchor="end">ROOT CAUSE</text>
                </g>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Tip of the Iceberg</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>You are solving for the part of the problem you can see. But in complex systems, the visible outcome is just a symptom.</p><div class="bg-[#1F1F1F] p-5 rounded border-l-2 border-[#D4AF37] mb-6 shadow-lg"><h4 class='text-white font-bold text-sm uppercase tracking-wide mb-2'>The "So That" Test</h4><p class='text-[#B0B0B0] text-sm'>If your goal is generic, ask "So that... what?"</p></div>`
          },
          {
            level: 2,
            title: "What breaks without this?",
            subtitle: "Identify the mechanical breakdown or direct consequence.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs>
                    <linearGradient id="metal" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor="#444" /><stop offset="50%" stopColor="#777" /><stop offset="100%" stopColor="#333" /></linearGradient>
                    <filter id="shadow"><feDropShadow dx="2" dy="2" stdDeviation="3" floodOpacity="0.5"/></filter>
                 </defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <path d="M0 50 H800 M0 150 H800 M0 250 H800 M0 350 H800 M0 450 H800" stroke="#222" strokeWidth="1" />
                 <path d="M50 0 V500 M150 0 V500 M250 0 V500 M350 0 V500 M450 0 V500 M550 0 V500" stroke="#222" strokeWidth="1" />
                 <g transform="translate(200, 250)" filter="url(#shadow)">
                    <circle cx="0" cy="0" r="80" fill="url(#metal)" stroke="#D4AF37" strokeWidth="2" />
                    <path d="M-80 0 L-60 0 M80 0 L60 0 M0 -80 L0 -60 M0 80 L0 60" stroke="#111" strokeWidth="4" />
                    <text x="0" y="5" fill="#D4AF37" fontSize="12" textAnchor="middle" fontWeight="bold">ACTION</text>
                 </g>
                 <g transform="translate(550, 250)" filter="url(#shadow)">
                    <circle cx="0" cy="0" r="90" fill="#E53E3E" fillOpacity="0.1" stroke="#E53E3E" strokeWidth="2" />
                    <text x="0" y="40" fill="#E53E3E" fontSize="12" textAnchor="middle" fontWeight="bold">FAILURE</text>
                 </g>
                 <path d="M280 250 L290 250" stroke="#D4AF37" strokeWidth="2" markerEnd="url(#arrow)" />
                 <path d="M410 250 L460 250" stroke="#E53E3E" strokeWidth="2" strokeDasharray="4 2" />
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Logic Chain</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>Level 2 identifies the <strong>functional breakdown</strong>. It is the "If P, then Q" statement.</p><div class="bg-[#1A1A1A] p-4 rounded border-t-2 border-[#D4AF37]"><strong class="text-white block mb-1">Good Logic</strong><p class="text-xs text-[#B0B0B0]">"If I don't lose weight, I physically cannot go hiking with my kids." (Functional Limit)</p></div>`
          },
          {
            level: 3,
            title: "What feeling is driving this?",
            subtitle: "Name the raw emotion you are running from or towards.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs><radialGradient id="coreHeat" cx="0.5" cy="0.5" r="0.5"><stop offset="0%" stopColor="#FF6B35" /><stop offset="60%" stopColor="#E53E3E" /><stop offset="100%" stopColor="#1A1A1A" /></radialGradient></defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <g transform="translate(400, 250)">
                    <path d="M-200 0 A 200 200 0 1 1 200 0" fill="none" stroke="#444" strokeWidth="40" strokeDasharray="4 2" />
                    <circle cx="0" cy="0" r="80" fill="url(#coreHeat)" />
                    <text x="0" y="5" fill="#FFFFFF" fontSize="16" fontWeight="bold" textAnchor="middle">FEAR</text>
                 </g>
                 <line x1="400" y1="250" x2="650" y2="250" stroke="#FF6B35" strokeWidth="2" />
                 <text x="660" y="255" fill="#FF6B35" fontSize="14" fontWeight="bold">EMOTIONAL DRIVER</text>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#FF6B35]'>The Reactor Core</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>Logic is the steering wheel, but emotion is the fuel. At Level 3, we stop pretending this is a "business decision".</p><div class="bg-[#1A1A1A] border border-[#FF6B35] p-5 rounded-lg mb-6"><h4 class='text-[#FF6B35] font-bold mb-2 uppercase text-xs tracking-wider'>The 2 Polarities</h4><p class="text-sm text-gray-400">Moving AWAY from Pain vs Moving TOWARD Pleasure</p></div>`
          },
          {
            level: 4,
            title: "Who are you becoming?",
            subtitle: "Confront the identity you are building or destroying.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs><linearGradient id="gridGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#D4AF37" stopOpacity="0.5"/><stop offset="100%" stopColor="#000" stopOpacity="0"/></linearGradient></defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <rect x="200" y="50" width="400" height="400" stroke="url(#gridGrad)" strokeWidth="1" strokeDasharray="10 10" />
                 <g transform="translate(400, 220)">
                    <rect x="-40" y="-30" width="80" height="60" stroke="#D4AF37" strokeWidth="2" fill="#D4AF37" fillOpacity="0.1" />
                    <circle cx="0" cy="0" r="5" fill="#D4AF37" />
                 </g>
                 <text x="400" y="100" fill="#D4AF37" fontSize="18" textAnchor="middle" fontWeight="bold">IDENTITY CONSTRUCT</text>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#E5C76B]'>The Architectural Blueprint</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>We act in accordance with who we believe we are. Level 4 digs into your <strong>Self-Concept</strong>.</p><div class="space-y-4 mb-6"><div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-[#1A1A1A] border border-[#D4AF37] flex items-center justify-center text-[#D4AF37] font-bold">1</div><div><strong class="text-white text-sm block">The Fear Identity</strong><span class="text-[#666] text-xs">"I am afraid I am becoming lazy/irrelevant/abandoned."</span></div></div></div>`
          },
          {
            level: 5,
            title: "The Origin Point",
            subtitle: "What is the core belief or past wound anchoring all of this?",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs><radialGradient id="magma" cx="0.5" cy="1" r="1"><stop offset="0%" stopColor="#D4AF37" /><stop offset="50%" stopColor="#B8962F" /><stop offset="100%" stopColor="#000" /></radialGradient></defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <path d="M400 100 L 400 450" stroke="#D4AF37" strokeWidth="2" strokeDasharray="2 2" />
                 <g transform="translate(400, 450)">
                    <circle cx="0" cy="0" r="150" fill="url(#magma)" opacity="0.2" filter="url(#glow)" />
                    <circle cx="0" cy="0" r="10" fill="#D4AF37" />
                 </g>
                 <text x="400" y="480" fill="#D4AF37" fontSize="14" textAnchor="middle" fontWeight="bold" letterSpacing="2">ORIGIN POINT</text>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Bedrock</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>This is the source code. The root cause is rarely about the future; it is almost always about the past.</p><div class="bg-[#1A1A1A] p-6 rounded-lg border border-[#333] mb-6"><h4 class='text-white font-bold mb-4 uppercase text-xs tracking-widest'>The 3 Archetypes of Root Cause</h4><ul class="space-y-3"><li class="flex gap-3"><span class="text-[#D4AF37]">✦</span><div class="text-sm text-[#B0B0B0]"><strong class="text-white">The Vow:</strong> A promise made in pain.</div></li></ul></div>`
          }
        ];

        // ==========================================
        // APP LOGIC
        // ==========================================

        const App = () => {
          const [appState, setAppState] = useState('INTRO'); // States: INTRO -> INFO -> DEFINE_PROBLEM -> ANALYSIS_LOOP -> SYNTHESIZING -> COMPLETE
          const [currentLevel, setCurrentLevel] = useState(1);
          const [initialProblem, setInitialProblem] = useState("");
          const [history, setHistory] = useState([]);
          const [synthesisResult, setSynthesisResult] = useState(null);
          const [loading, setLoading] = useState(false);
          const [activeQuestion, setActiveQuestion] = useState("What do you want?");
          const [inputText, setInputText] = useState("");
          const bottomRef = useRef(null);

          // Auto-scroll logic
          useEffect(() => { 
            if(bottomRef.current) bottomRef.current.scrollIntoView({ behavior: 'smooth' }); 
          }, [history, loading, activeQuestion]);

          const handleIntroStart = () => {
              setAppState('INFO');
          };
          
          const handleInfoComplete = () => {
              setAppState('DEFINE_PROBLEM');
          };

          const handleStartExcavation = () => {
             const h = [{ level: 1, question: "What do you want?", answer: initialProblem }];
             setHistory(h);
             setAppState('ANALYSIS_LOOP');
             setLoading(true);
             generateNextQuestion(h, 2).then(q => { 
                 setActiveQuestion(q); 
                 setCurrentLevel(2); 
                 setLoading(false); 
             });
          };

          const handleNext = async () => {
             if(!inputText.trim()) return;
             
             // 1. Add User Answer to History
             const newHistory = [...history, { level: currentLevel, question: activeQuestion, answer: inputText }];
             setHistory(newHistory);
             setInputText("");
             setLoading(true);
             
             // 2. Determine Next Step
             if(currentLevel < 5) {
                const nextLevel = currentLevel + 1;
                const q = await generateNextQuestion(newHistory, nextLevel);
                setActiveQuestion(q);
                setCurrentLevel(nextLevel);
                setLoading(false);
             } else {
                setAppState('SYNTHESIZING');
                const rep = await generateSynthesis(newHistory);
                setSynthesisResult(rep);
                setAppState('COMPLETE');
                setLoading(false);
             }
          };

          // --- COMPONENT: INTRO SCREEN ---
          const IntroScreen = ({ onStart }) => (
            <div className="h-full w-full ember-bg flex flex-col items-center justify-center text-center p-8 animate-fade-in-up relative z-50">
                <div className="max-w-4xl mx-auto">
                    <div className="mb-6">
                        <svg className="w-16 h-16 mx-auto mb-6 text-[#D4AF37]" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                        </svg>
                    </div>
                    <h1 className="text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-[#D4AF37] to-[#FF6A00] mb-2 tracking-tighter">
                        5 LEVELS
                    </h1>
                    <h2 className="text-4xl md:text-6xl font-bold text-white mb-8 tracking-[0.2em] uppercase">
                        OF WHY
                    </h2>
                    <p className="text-[#B0B0B0] text-lg md:text-xl max-w-2xl mx-auto mb-12 font-light leading-relaxed">
                        Drift is the enemy. Clarity is the weapon.<br/>
                        Excavate the hidden story running your life.
                    </p>
                    <button 
                        onClick={onStart}
                        className="pulse-glow px-12 py-5 bg-[#D4AF37] text-black font-black text-lg uppercase tracking-[0.15em] hover:bg-white transition-all transform hover:scale-105"
                    >
                        START EXCAVATION
                    </button>
                </div>
            </div>
          );

          // --- COMPONENT: INFO SCREEN ---
          const InfoScreen = ({ onNext }) => (
            <div className="h-full w-full bg-[#0D0D0D] overflow-y-auto custom-scrollbar p-6 animate-fade-in-up">
              <div className="max-w-5xl mx-auto pt-10 pb-20">
                
                <h2 className="text-[#D4AF37] font-bold tracking-[0.3em] uppercase mb-12 text-center text-2xl">The Briefing</h2>
                
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                   
                   {/* STRATA VISUALIZATION */}
                   <div className="bg-[#1A1A1A] border border-[#333] p-8 rounded-xl shadow-2xl relative overflow-hidden group">
                      <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#D4AF37] to-[#FF6A00]"></div>
                      <svg className="w-full h-full min-h-[400px]" viewBox="0 0 400 500" fill="none">
                          <defs>
                             <linearGradient id="drillGrad" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stopColor="#FFF" stopOpacity="0.8"/>
                                <stop offset="100%" stopColor="#D4AF37" stopOpacity="0.2"/>
                             </linearGradient>
                             <pattern id="rockPattern" width="20" height="20" patternUnits="userSpaceOnUse">
                                <circle cx="2" cy="2" r="1" fill="#333"/>
                                <circle cx="12" cy="12" r="1" fill="#222"/>
                             </pattern>
                          </defs>

                          {/* Shaft Line */}
                          <line x1="200" y1="50" x2="200" y2="450" stroke="url(#drillGrad)" strokeWidth="2" strokeDasharray="4 4" />
                          <circle cx="200" cy="50" r="4" fill="#D4AF37" />
                          <circle cx="200" cy="450" r="4" fill="#FF6A00" />

                          {/* Level 1: Surface */}
                          <g transform="translate(50, 50)">
                             <path d="M0 20 Q 150 10 300 20" stroke="#4a5d23" strokeWidth="2" fill="none"/>
                             <text x="20" y="0" fill="#FFF" fontSize="12" fontWeight="bold">L1: THE WANT</text>
                             <text x="20" y="15" fill="#666" fontSize="10">Surface Goal</text>
                             <line x1="280" y1="20" x2="150" y2="20" stroke="#333" strokeDasharray="2 2" />
                          </g>

                          {/* Level 2: Mechanics */}
                          <g transform="translate(50, 150)">
                             <rect x="0" y="0" width="300" height="40" fill="url(#rockPattern)" opacity="0.5"/>
                             <text x="20" y="25" fill="#FFF" fontSize="12" fontWeight="bold">L2: THE BREAK</text>
                             <text x="260" y="25" fill="#888" fontSize="10" textAnchor="end">Mechanical Failure</text>
                          </g>

                          {/* Level 3: Emotion */}
                          <g transform="translate(50, 250)">
                             <path d="M0 10 Q 75 30 150 10 T 300 10" fill="none" stroke="#FF6A00" strokeWidth="2" opacity="0.6"/>
                             <text x="20" y="0" fill="#FF6A00" fontSize="12" fontWeight="bold">L3: THE FUEL</text>
                             <text x="20" y="35" fill="#888" fontSize="10">Raw Emotion</text>
                          </g>

                          {/* Level 4: Identity */}
                          <g transform="translate(50, 350)">
                             <rect x="0" y="0" width="300" height="40" stroke="#444" fill="none" strokeDasharray="4 4"/>
                             <text x="20" y="25" fill="#FFF" fontSize="12" fontWeight="bold">L4: THE CONSTRUCT</text>
                             <text x="260" y="25" fill="#888" fontSize="10" textAnchor="end">Self-Concept</text>
                          </g>

                          {/* Level 5: Core */}
                          <g transform="translate(50, 430)">
                             <circle cx="150" cy="20" r="30" fill="radial-gradient(#D4AF37, #000)" opacity="0.3"/>
                             <text x="150" y="25" fill="#D4AF37" fontSize="14" fontWeight="bold" textAnchor="middle">L5: THE VOW</text>
                          </g>
                      </svg>
                   </div>

                   {/* TEXT CONTENT */}
                   <div className="space-y-8">
                       <div>
                           <h3 className="text-3xl font-bold text-white mb-4">THE ARCHITECTURE OF TRUTH</h3>
                           <p className="text-[#B0B0B0] text-lg leading-relaxed">
                               Most people spend their lives solving for symptoms. They want money, so they work harder. They want weight loss, so they diet. But 90% of the time, the problem isn't the problem.<br/><br/>
                               The <strong>"5 Levels of Why"</strong> is a surgical tool designed to bypass your logical defenses and locate the <em>root driver</em>—the silent engine running your life.
                           </p>
                       </div>

                       <div className="bg-[#1A1A1A] p-6 border-l-4 border-[#D4AF37]">
                           <h4 className="text-white font-bold uppercase tracking-wide mb-4">Engagement Rules</h4>
                           <ul className="space-y-4 text-[#CCCCCC]">
                               <li className="flex gap-3">
                                   <span className="text-[#D4AF37] font-bold">01.</span>
                                   <span><strong>Turn off the PR Manager.</strong> Do not give the "correct" answer. Give the real one.</span>
                               </li>
                               <li className="flex gap-3">
                                   <span className="text-[#D4AF37] font-bold">02.</span>
                                   <span><strong>Follow the Pain.</strong> If an answer makes you uncomfortable, you are on the right track.</span>
                               </li>
                               <li className="flex gap-3">
                                   <span className="text-[#D4AF37] font-bold">03.</span>
                                   <span><strong>Speed Matters.</strong> Don't over-intellectualize. Go with your gut response.</span>
                               </li>
                           </ul>
                       </div>

                       <button 
                          onClick={onNext}
                          className="w-full btn-primary py-5 rounded text-lg font-bold shadow-2xl hover:scale-[1.02] transition-transform"
                       >
                          I UNDERSTAND - BEGIN
                       </button>
                   </div>

                </div>
              </div>
            </div>
          );

          // --- COMPONENTS ---
          const Bubble = ({ txt, isUser }) => (
            <div className={`flex w-full mb-6 ${isUser ? 'justify-end' : 'justify-start'}`}>
              <div className={`max-w-[85%] p-5 rounded-xl ${isUser ? 'bg-[#2A2A2A] border border-[#333]' : 'bg-[#D4AF37] bg-opacity-10 border border-[#D4AF37] border-opacity-30'}`}>
                <p className="text-white whitespace-pre-wrap">{txt}</p>
              </div>
            </div>
          );

          const KnowledgeCard = ({ level }) => {
             const d = LEVEL_GUIDE_DATA[level - 1];
             if(!d) return null;
             return (
               <div className="bg-[#1A1A1A] p-6 h-full border-l border-[#333] overflow-y-auto custom-scrollbar">
                  <div className="mb-6"><span className="text-[#D4AF37] text-xs font-bold border border-[#D4AF37] px-2 py-1 rounded">LEVEL {d.level}</span><h2 className="text-2xl font-bold mt-2">{d.title}</h2><p className="text-[#B0B0B0]">{d.subtitle}</p></div>
                  <div className="aspect-video bg-black mb-6 rounded border border-[#333] p-4">{d.svgContent}</div>
                  <div className="prose prose-invert prose-sm" dangerouslySetInnerHTML={{__html: d.htmlBody}} />
               </div>
             );
          };

          return (
            <div className="flex h-screen w-full bg-[#0D0D0D]">
                {/* OVERLAYS */}
                {appState === 'INTRO' && (
                    <div className="fixed inset-0 z-50">
                        <IntroScreen onStart={handleIntroStart} />
                    </div>
                )}

                {/* INFO SCREEN (Replaces Main App Temporarily) */}
                {appState === 'INFO' && (
                    <div className="fixed inset-0 z-40 bg-[#0D0D0D]">
                        <InfoScreen onNext={handleInfoComplete} />
                    </div>
                )}

                {/* MAIN APP */}
                {(appState !== 'INTRO' && appState !== 'INFO') && (
                    <>
                        {/* LEFT SIDE: CHAT */}
                        <div className={`flex-1 flex flex-col relative z-10 ${appState === 'COMPLETE' ? 'w-full' : 'lg:w-1/2'}`}>
                            
                            <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                                <div className="max-w-3xl mx-auto pt-8">
                                     {/* HEADER */}
                                     <div className="text-center mb-8">
                                        <h1 className="text-[#D4AF37] font-bold tracking-[0.3em] text-2xl">UNSHAKABLE</h1>
                                        <p className="text-[#666] text-xs tracking-widest mt-1">5 LEVELS OF WHY</p>
                                     </div>

                                     {/* DEFINE PROBLEM SCREEN (Level 1) */}
                                     {appState === 'DEFINE_PROBLEM' && (
                                        <div className="bg-[#1A1A1A] p-8 rounded-xl border border-[#333] animate-fade-in-up">
                                            <div className="flex items-center gap-3 mb-4">
                                                <span className="w-8 h-8 rounded-full bg-[#D4AF37] text-black font-bold flex items-center justify-center">1</span>
                                                <h3 className="text-xl font-bold text-white uppercase tracking-wider">The Surface</h3>
                                            </div>
                                            <h3 className="text-2xl font-light mb-6 text-[#E5E5E5]">What is the specific result you are chasing?</h3>
                                            <textarea 
                                                value={initialProblem} 
                                                onChange={e => setInitialProblem(e.target.value)} 
                                                className="w-full bg-black border border-[#333] p-6 rounded-lg text-lg h-40 outline-none focus:border-[#D4AF37] text-white placeholder-[#444] leading-relaxed" 
                                                placeholder="I want to make $50k/month... I want to lose 30lbs... I want to quit my job..." 
                                            />
                                            <button 
                                                onClick={handleStartExcavation} 
                                                disabled={!initialProblem} 
                                                className="w-full mt-6 btn-primary py-5 rounded font-bold transition-transform text-lg"
                                            >
                                                BEGIN EXCAVATION
                                            </button>
                                        </div>
                                     )}

                                     {/* CHAT LOOP */}
                                     {(appState === 'ANALYSIS_LOOP' || appState === 'SYNTHESIZING' || appState === 'COMPLETE') && (
                                        <div className="pb-8">
                                            {history.map((h, i) => (
                                                <Fragment key={i}>
                                                    <Bubble txt={h.question} />
                                                    <Bubble txt={h.answer} isUser />
                                                </Fragment>
                                            ))}
                                            
                                            {appState === 'ANALYSIS_LOOP' && !loading && (
                                                <div className="animate-fade-in-up">
                                                    <Bubble txt={activeQuestion} />
                                                    {/* Mobile Card Show */}
                                                    <div className="lg:hidden mt-4 mb-4">
                                                        <div className="bg-[#1A1A1A] border border-[#333] p-4 rounded text-center">
                                                            <span className="text-[#D4AF37] text-xs font-bold">LEVEL {currentLevel} GUIDE BELOW</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {loading && (
                                                <div className="flex items-center gap-2 p-4 text-[#D4AF37] text-xs tracking-widest animate-pulse">
                                                    <span>DIGGING DEEPER</span>
                                                    <span className="text-lg">...</span>
                                                </div>
                                            )}

                                            {appState === 'COMPLETE' && synthesisResult && (
                                                <div className="bg-[#1A1A1A] p-8 rounded border-l-4 border-[#D4AF37] animate-fade-in shadow-2xl mt-8">
                                                    <div className="mb-6">
                                                        <span className="text-[#D4AF37] text-xs font-bold uppercase tracking-widest">TRUE NORTH</span>
                                                        <h2 className="text-white text-3xl font-bold mt-2 mb-6">Excavation Complete</h2>
                                                        <p className="text-xl font-light text-[#E0E0E0] leading-relaxed whitespace-pre-wrap">{synthesisResult.whyStatement}</p>
                                                    </div>
                                                    <div className="bg-black p-6 border border-[#333] rounded text-center">
                                                        <span className="text-[#666] text-xs uppercase tracking-widest mb-2 block">YOUR EMOTIONAL CORE</span>
                                                        <p className="text-2xl font-serif italic text-[#D4AF37]">"{synthesisResult.emotionalCore}"</p>
                                                    </div>
                                                    <button onClick={() => window.location.reload()} className="w-full mt-8 border border-[#333] py-4 rounded text-[#666] hover:text-white hover:border-[#D4AF37] transition-colors uppercase tracking-widest text-xs font-bold">START NEW SESSION</button>
                                                </div>
                                            )}
                                            <div ref={bottomRef} />
                                        </div>
                                     )}
                                </div>
                            </div>

                            {/* INPUT AREA */}
                            {appState === 'ANALYSIS_LOOP' && (
                                <div className="p-4 bg-[#1A1A1A] border-t border-[#333] shadow-2xl">
                                    <div className="max-w-3xl mx-auto flex gap-4">
                                        <input 
                                            value={inputText} 
                                            onChange={e => setInputText(e.target.value)} 
                                            onKeyDown={e => e.key === 'Enter' && handleNext()} 
                                            className="flex-1 bg-black border border-[#333] rounded px-6 py-4 outline-none focus:border-[#D4AF37] text-white text-lg transition-colors placeholder-[#333]" 
                                            autoFocus 
                                            placeholder="Type your honest answer here..." 
                                            disabled={loading}
                                        />
                                        <button 
                                            onClick={handleNext} 
                                            disabled={!inputText || loading} 
                                            className="bg-[#D4AF37] hover:bg-[#B8962F] text-black font-bold px-8 rounded transition-all disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-wide"
                                        >
                                            NEXT
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* RIGHT SIDE: KNOWLEDGE PANEL (Desktop Only) */}
                        {appState !== 'COMPLETE' && (
                            <div className="hidden lg:block w-1/2 h-full shadow-2xl relative z-20">
                                <KnowledgeCard level={currentLevel} />
                            </div>
                        )}
                    </>
                )}
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
