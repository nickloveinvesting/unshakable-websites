<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IGNITE | 5 Levels of Why</title>
    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "@google/genai": "https://esm.sh/@google/genai@0.1.1"
      }
    }
    </script>

    <style>
      :root {
        --bg-dark: #0A0A0A;
        --gold-primary: #D4AF37;
        --fire-end: #FF6A00;
      }

      body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-dark);
        color: white;
        overflow: hidden;
        margin: 0;
        padding: 0;
      }

      /* Animations and Scrollbars */
      .custom-scrollbar::-webkit-scrollbar { width: 6px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: var(--bg-dark); }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
      
      @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
      .animate-fade-in { animation: fade-in 0.6s ease-out forwards; }
      
      @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      .animate-fade-in-up { animation: fade-in-up 0.5s ease-out forwards; }

      .btn-primary {
        background: linear-gradient(135deg, var(--gold-primary), var(--fire-end));
        color: white;
        text-transform: uppercase;
        font-weight: 700;
        border: none;
      }
      .btn-primary:hover:not(:disabled) {
        box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        transform: translateY(-1px);
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, Fragment } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI } from '@google/genai';

        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        // !!! OPERATOR: PASTE YOUR API KEY HERE !!!
        const API_KEY = "YOUR_API_KEY_HERE"; 
        
        const MODEL_LITE = 'gemini-2.0-flash-lite-preview-02-05'; 
        const MODEL_PRO = 'gemini-2.0-flash';

        // ==========================================
        // DATA & CONTENT
        // ==========================================

        const LEVEL_GUIDE_DATA = [
          {
            level: 1,
            title: "What do you want?",
            subtitle: "Describe the specific result or outcome you are chasing.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                <defs>
                  <linearGradient id="skyGrad" x1="0" y1="0" x2="0" y2="250"><stop offset="0%" stopColor="#0D0D0D" /><stop offset="100%" stopColor="#1A1A1A" /></linearGradient>
                  <linearGradient id="waterGrad" x1="0" y1="250" x2="0" y2="500"><stop offset="0%" stopColor="#1A1A1A" stopOpacity="0.8" /><stop offset="100%" stopColor="#000000" stopOpacity="0.95" /></linearGradient>
                  <linearGradient id="iceLight" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor="#FFFFFF" /><stop offset="100%" stopColor="#D4AF37" /></linearGradient>
                  <linearGradient id="iceDark" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor="#333333" /><stop offset="100%" stopColor="#111111" /></linearGradient>
                  <filter id="glow" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="5" result="blur" /><feComposite in="SourceGraphic" in2="blur" operator="over" /></filter>
                </defs>
                <rect width="800" height="250" fill="url(#skyGrad)" />
                <rect y="250" width="800" height="250" fill="url(#waterGrad)" />
                <line x1="0" y1="250" x2="800" y2="250" stroke="#D4AF37" strokeWidth="1" strokeDasharray="4 4" opacity="0.5" />
                <text x="780" y="240" fill="#D4AF37" fontSize="12" fontFamily="monospace" textAnchor="end" opacity="0.8">WATERLINE [VISIBILITY THRESHOLD]</text>
                <g filter="url(#glow)">
                   <path d="M400 100 L460 250 L340 250 Z" fill="url(#iceLight)" stroke="#D4AF37" strokeWidth="2" />
                   <path d="M400 100 L430 250 L460 250 Z" fill="#B8962F" opacity="0.5" />
                </g>
                <path d="M340 250 L300 350 L350 450 L450 480 L500 380 L460 250 Z" fill="url(#iceDark)" stroke="#444" strokeWidth="1" opacity="0.8" />
                <g transform="translate(500, 120)">
                    <line x1="0" y1="0" x2="-40" y2="20" stroke="#D4AF37" />
                    <circle cx="0" cy="0" r="3" fill="#D4AF37" />
                    <text x="10" y="4" fill="#FFFFFF" fontSize="14" fontWeight="bold">SYMPTOM</text>
                </g>
                <g transform="translate(250, 350)">
                    <line x1="0" y1="0" x2="50" y2="0" stroke="#666" />
                    <circle cx="0" cy="0" r="3" fill="#666" />
                    <text x="-10" y="4" fill="#666" fontSize="14" textAnchor="end">ROOT CAUSE</text>
                </g>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Tip of the Iceberg</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>You are solving for the part of the problem you can see. But in complex systems, the visible outcome is just a symptom.</p><div class="bg-[#1F1F1F] p-5 rounded border-l-2 border-[#D4AF37] mb-6 shadow-lg"><h4 class='text-white font-bold text-sm uppercase tracking-wide mb-2'>The "So That" Test</h4><p class='text-[#B0B0B0] text-sm'>If your goal is generic, ask "So that... what?"</p></div>`
          },
          {
            level: 2,
            title: "What breaks without this?",
            subtitle: "Identify the mechanical breakdown or direct consequence.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs>
                    <linearGradient id="metal" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor="#444" /><stop offset="50%" stopColor="#777" /><stop offset="100%" stopColor="#333" /></linearGradient>
                    <filter id="shadow"><feDropShadow dx="2" dy="2" stdDeviation="3" floodOpacity="0.5"/></filter>
                 </defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <path d="M0 50 H800 M0 150 H800 M0 250 H800 M0 350 H800 M0 450 H800" stroke="#222" strokeWidth="1" />
                 <path d="M50 0 V500 M150 0 V500 M250 0 V500 M350 0 V500 M450 0 V500 M550 0 V500" stroke="#222" strokeWidth="1" />
                 <g transform="translate(200, 250)" filter="url(#shadow)">
                    <circle cx="0" cy="0" r="80" fill="url(#metal)" stroke="#D4AF37" strokeWidth="2" />
                    <path d="M-80 0 L-60 0 M80 0 L60 0 M0 -80 L0 -60 M0 80 L0 60" stroke="#111" strokeWidth="4" />
                    <text x="0" y="5" fill="#D4AF37" fontSize="12" textAnchor="middle" fontWeight="bold">ACTION</text>
                 </g>
                 <g transform="translate(550, 250)" filter="url(#shadow)">
                    <circle cx="0" cy="0" r="90" fill="#E53E3E" fillOpacity="0.1" stroke="#E53E3E" strokeWidth="2" />
                    <text x="0" y="40" fill="#E53E3E" fontSize="12" textAnchor="middle" fontWeight="bold">FAILURE</text>
                 </g>
                 <path d="M280 250 L290 250" stroke="#D4AF37" strokeWidth="2" markerEnd="url(#arrow)" />
                 <path d="M410 250 L460 250" stroke="#E53E3E" strokeWidth="2" strokeDasharray="4 2" />
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Logic Chain</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>Level 2 identifies the <strong>functional breakdown</strong>. It is the "If P, then Q" statement.</p><div class="bg-[#1A1A1A] p-4 rounded border-t-2 border-[#D4AF37]"><strong class="text-white block mb-1">Good Logic</strong><p class="text-xs text-[#B0B0B0]">"If I don't lose weight, I physically cannot go hiking with my kids." (Functional Limit)</p></div>`
          },
          {
            level: 3,
            title: "What feeling is driving this?",
            subtitle: "Name the raw emotion you are running from or towards.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs><radialGradient id="coreHeat" cx="0.5" cy="0.5" r="0.5"><stop offset="0%" stopColor="#FF6B35" /><stop offset="60%" stopColor="#E53E3E" /><stop offset="100%" stopColor="#1A1A1A" /></radialGradient></defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <g transform="translate(400, 250)">
                    <path d="M-200 0 A 200 200 0 1 1 200 0" fill="none" stroke="#444" strokeWidth="40" strokeDasharray="4 2" />
                    <circle cx="0" cy="0" r="80" fill="url(#coreHeat)" />
                    <text x="0" y="5" fill="#FFFFFF" fontSize="16" fontWeight="bold" textAnchor="middle">FEAR</text>
                 </g>
                 <line x1="400" y1="250" x2="650" y2="250" stroke="#FF6B35" strokeWidth="2" />
                 <text x="660" y="255" fill="#FF6B35" fontSize="14" fontWeight="bold">EMOTIONAL DRIVER</text>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#FF6B35]'>The Reactor Core</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>Logic is the steering wheel, but emotion is the fuel. At Level 3, we stop pretending this is a "business decision".</p><div class="bg-[#1A1A1A] border border-[#FF6B35] p-5 rounded-lg mb-6"><h4 class='text-[#FF6B35] font-bold mb-2 uppercase text-xs tracking-wider'>The 2 Polarities</h4><p class="text-sm text-gray-400">Moving AWAY from Pain vs Moving TOWARD Pleasure</p></div>`
          },
          {
            level: 4,
            title: "Who are you becoming?",
            subtitle: "Confront the identity you are building or destroying.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs><linearGradient id="gridGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#D4AF37" stopOpacity="0.5"/><stop offset="100%" stopColor="#000" stopOpacity="0"/></linearGradient></defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <rect x="200" y="50" width="400" height="400" stroke="url(#gridGrad)" strokeWidth="1" strokeDasharray="10 10" />
                 <g transform="translate(400, 220)">
                    <rect x="-40" y="-30" width="80" height="60" stroke="#D4AF37" strokeWidth="2" fill="#D4AF37" fillOpacity="0.1" />
                    <circle cx="0" cy="0" r="5" fill="#D4AF37" />
                 </g>
                 <text x="400" y="100" fill="#D4AF37" fontSize="18" textAnchor="middle" fontWeight="bold">IDENTITY CONSTRUCT</text>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#E5C76B]'>The Architectural Blueprint</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>We act in accordance with who we believe we are. Level 4 digs into your <strong>Self-Concept</strong>.</p><div class="space-y-4 mb-6"><div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-[#1A1A1A] border border-[#D4AF37] flex items-center justify-center text-[#D4AF37] font-bold">1</div><div><strong class="text-white text-sm block">The Fear Identity</strong><span class="text-[#666] text-xs">"I am afraid I am becoming lazy/irrelevant/abandoned."</span></div></div></div>`
          },
          {
            level: 5,
            title: "The Origin Point",
            subtitle: "What is the core belief or past wound anchoring all of this?",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none">
                 <defs><radialGradient id="magma" cx="0.5" cy="1" r="1"><stop offset="0%" stopColor="#D4AF37" /><stop offset="50%" stopColor="#B8962F" /><stop offset="100%" stopColor="#000" /></radialGradient></defs>
                 <rect width="800" height="500" fill="#0D0D0D" />
                 <path d="M400 100 L 400 450" stroke="#D4AF37" strokeWidth="2" strokeDasharray="2 2" />
                 <g transform="translate(400, 450)">
                    <circle cx="0" cy="0" r="150" fill="url(#magma)" opacity="0.2" filter="url(#glow)" />
                    <circle cx="0" cy="0" r="10" fill="#D4AF37" />
                 </g>
                 <text x="400" y="480" fill="#D4AF37" fontSize="14" textAnchor="middle" fontWeight="bold" letterSpacing="2">ORIGIN POINT</text>
              </svg>
            ),
            htmlBody: `<h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Bedrock</h3><p class='mb-6 text-[#B0B0B0] leading-relaxed'>This is the source code. The root cause is rarely about the future; it is almost always about the past.</p><div class="bg-[#1A1A1A] p-6 rounded-lg border border-[#333] mb-6"><h4 class='text-white font-bold mb-4 uppercase text-xs tracking-widest'>The 3 Archetypes of Root Cause</h4><ul class="space-y-3"><li class="flex gap-3"><span class="text-[#D4AF37]">âœ¦</span><div class="text-sm text-[#B0B0B0]"><strong class="text-white">The Vow:</strong> A promise made in pain.</div></li></ul></div>`
          }
        ];

        // ==========================================
        // SERVICES
        // ==========================================

        const generateNextQuestion = async (history, currentLevel) => {
          try {
            if (API_KEY === "YOUR_API_KEY_HERE" || !API_KEY) return "API Key is missing. Edit the file to add it.";

            const ai = new GoogleGenAI({ apiKey: API_KEY });
            const historyText = history.map(h => `Level ${h.level} A: ${h.answer}`).join('\n');
            const lastAnswer = history[history.length - 1].answer;
            
            let systemPrompt = `ROLE: Socratic Coach. LEVEL: ${currentLevel}. `;
            
            if (currentLevel === 2) systemPrompt += `Ask what MECHANICAL thing breaks if they don't get "${lastAnswer}". What becomes impossible?`;
            else if (currentLevel === 3) systemPrompt += `Ask for the EMOTION behind "${lastAnswer}". Fear? Shame? Pride?`;
            else if (currentLevel === 4) systemPrompt += `Ask what "${lastAnswer}" says about their IDENTITY. Who are they afraid of becoming?`;
            else if (currentLevel === 5) systemPrompt += `Ask about the ROOT ORIGIN of that identity fear. When did it start?`;

            const response = await ai.models.generateContent({
              model: MODEL_LITE,
              contents: { role: 'user', parts: [{ text: systemPrompt + `\nUSER ANSWER: ${lastAnswer}` }] },
            });

            return response.response.text().trim();
          } catch (error) {
            console.error(error);
            return "Error contacting AI. Check API Key/Console.";
          }
        };

        const generateSynthesis = async (history) => {
          try {
            if (API_KEY === "YOUR_API_KEY_HERE") return { whyStatement: "API Key Missing", emotionalCore: "Check Code" };
            const ai = new GoogleGenAI({ apiKey: API_KEY });
            const historyText = history.map(h => `L${h.level}: ${h.answer}`).join('\n');
            const prompt = `Analyze this "5 Whys" session:\n${historyText}\n\nReturn JSON: { "whyStatement": "150 word summary connecting L1 to L5", "emotionalCore": "1 sentence punchy truth" }`;

            const response = await ai.models.generateContent({
              model: MODEL_PRO,
              contents: { role: 'user', parts: [{ text: prompt }] },
              config: { responseMimeType: 'application/json' }
            });
            return JSON.parse(response.response.text());
          } catch (error) {
            return { whyStatement: "Error generating report.", emotionalCore: "System Offline" };
          }
        };

        // ==========================================
        // APP LOGIC
        // ==========================================

        const App = () => {
          const [appState, setAppState] = useState('DEFINE_PROBLEM');
          const [currentLevel, setCurrentLevel] = useState(1);
          const [initialProblem, setInitialProblem] = useState("");
          const [history, setHistory] = useState([]);
          const [synthesisResult, setSynthesisResult] = useState(null);
          const [loading, setLoading] = useState(false);
          const [activeQuestion, setActiveQuestion] = useState("What do you want?");
          const [inputText, setInputText] = useState("");
          const bottomRef = useRef(null);

          useEffect(() => { bottomRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [history, loading]);

          const handleStart = () => {
             const h = [{ level: 1, question: "What do you want?", answer: initialProblem }];
             setHistory(h);
             setAppState('ANALYSIS_LOOP');
             setLoading(true);
             generateNextQuestion(h, 2).then(q => { setActiveQuestion(q); setCurrentLevel(2); setLoading(false); });
          };

          const handleNext = async () => {
             if(!inputText.trim()) return;
             setLoading(true);
             const h = [...history, { level: currentLevel, question: activeQuestion, answer: inputText }];
             setHistory(h);
             setInputText("");
             
             if(currentLevel < 5) {
                const q = await generateNextQuestion(h, currentLevel + 1);
                setActiveQuestion(q);
                setCurrentLevel(currentLevel + 1);
             } else {
                setAppState('SYNTHESIZING');
                const rep = await generateSynthesis(h);
                setSynthesisResult(rep);
                setAppState('COMPLETE');
             }
             setLoading(false);
          };

          // Render Helpers
          const Bubble = ({ txt, isUser }) => (
            <div className={`flex w-full mb-6 ${isUser ? 'justify-end' : 'justify-start'}`}>
              <div className={`max-w-[85%] p-5 rounded-xl ${isUser ? 'bg-[#2A2A2A] border border-[#333]' : 'bg-[#D4AF37] bg-opacity-10 border border-[#D4AF37] border-opacity-30'}`}>
                <p className="text-white whitespace-pre-wrap">{txt}</p>
              </div>
            </div>
          );

          const KnowledgeCard = ({ level }) => {
             const d = LEVEL_GUIDE_DATA[level - 1];
             return (
               <div className="bg-[#1A1A1A] p-6 h-full border-l border-[#333] overflow-y-auto custom-scrollbar">
                  <div className="mb-6"><span className="text-[#D4AF37] text-xs font-bold border border-[#D4AF37] px-2 py-1 rounded">LEVEL {d.level}</span><h2 className="text-2xl font-bold mt-2">{d.title}</h2><p className="text-[#B0B0B0]">{d.subtitle}</p></div>
                  <div className="aspect-video bg-black mb-6 rounded border border-[#333] p-4">{d.svgContent}</div>
                  <div className="prose prose-invert prose-sm" dangerouslySetInnerHTML={{__html: d.htmlBody}} />
               </div>
             );
          };

          return (
            <div className="flex h-screen w-full bg-[#0D0D0D]">
                <div className={`flex-1 flex flex-col relative z-10 ${appState === 'COMPLETE' ? 'w-full' : 'lg:w-1/2'}`}>
                    <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                        <div className="max-w-3xl mx-auto pt-8">
                             <div className="text-center mb-8">
                                <h1 className="text-[#D4AF37] font-bold tracking-[0.3em]">UNSHAKABLE</h1>
                                <p className="text-[#666] text-xs tracking-widest mt-1">5 LEVELS OF WHY</p>
                             </div>

                             {appState === 'DEFINE_PROBLEM' && (
                                <div className="bg-[#1A1A1A] p-8 rounded-xl border border-[#333] animate-fade-in-up">
                                    <h3 className="text-2xl font-light mb-6">What is the result you are chasing?</h3>
                                    <textarea value={initialProblem} onChange={e => setInitialProblem(e.target.value)} className="w-full bg-black border border-[#333] p-4 rounded text-lg h-32 outline-none focus:border-[#D4AF37]" placeholder="I want..." />
                                    <button onClick={handleStart} disabled={!initialProblem} className="w-full mt-6 btn-primary py-4 rounded font-bold">BEGIN EXCAVATION</button>
                                </div>
                             )}

                             {(appState === 'ANALYSIS_LOOP' || appState === 'COMPLETE') && (
                                <div className="pb-8">
                                    {history.map((h, i) => <Fragment key={i}><Bubble txt={h.question} /><Bubble txt={h.answer} isUser /></Fragment>)}
                                    {appState === 'ANALYSIS_LOOP' && !loading && <Bubble txt={activeQuestion} />}
                                    {loading && <div className="text-[#D4AF37] text-xs animate-pulse p-4">DIGGING DEEPER...</div>}
                                    {appState === 'COMPLETE' && synthesisResult && (
                                        <div className="bg-[#1A1A1A] p-8 rounded border border-[#D4AF37] animate-fade-in">
                                            <h2 className="text-[#D4AF37] font-bold mb-4">TRUE NORTH</h2>
                                            <p className="text-xl font-light mb-8">{synthesisResult.whyStatement}</p>
                                            <div className="border-t border-[#333] pt-6"><p className="text-2xl font-serif italic text-center">"{synthesisResult.emotionalCore}"</p></div>
                                            <button onClick={() => window.location.reload()} className="w-full mt-8 border border-[#333] py-3 rounded text-[#666] hover:text-white hover:border-[#D4AF37]">RESTART</button>
                                        </div>
                                    )}
                                    <div ref={bottomRef} />
                                </div>
                             )}
                        </div>
                    </div>
                    {appState === 'ANALYSIS_LOOP' && (
                        <div className="p-4 bg-[#1A1A1A] border-t border-[#333]">
                            <div className="max-w-3xl mx-auto flex gap-4">
                                <input value={inputText} onChange={e => setInputText(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleNext()} className="flex-1 bg-black border border-[#333] rounded px-4 py-3 outline-none focus:border-[#D4AF37]" autoFocus placeholder="Your answer..." />
                                <button onClick={handleNext} disabled={!inputText} className="bg-[#D4AF37] text-black font-bold px-8 rounded">NEXT</button>
                            </div>
                        </div>
                    )}
                </div>
                {appState !== 'COMPLETE' && <div className="hidden lg:block w-1/2 h-full"><KnowledgeCard level={currentLevel} /></div>}
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
