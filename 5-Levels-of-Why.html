<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IGNITE | 5 Levels of Why</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google GenAI SDK via Import Map -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.run/@google/genai",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>

    <style>
      :root {
        /* Primary Brand */
        --gold-primary: #D4AF37;
        --gold-light: #E5C76B;
        --gold-dark: #B8962F;
        
        /* Fire Accent */
        --fire-orange: #FF6B35;
        --fire-red: #E53E3E;
        
        /* Backgrounds */
        --bg-dark: #0D0D0D;
        --bg-card: #1A1A1A;
        --bg-elevated: #1F1F1F;
        --bg-subtle: #2A2A2A;
        
        /* Text */
        --text-primary: #FFFFFF;
        --text-secondary: #B0B0B0;
        --text-muted: #6B6B6B;
        
        /* Borders */
        --border-subtle: #333333;
        --border-focus: #D4AF37;
      }

      body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-dark);
        color: var(--text-primary);
        overflow: hidden; /* App handles scrolling */
        margin: 0;
        padding: 0;
      }

      /* Custom Scrollbar */
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: var(--bg-dark);
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: var(--bg-subtle);
        border-radius: 3px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: var(--border-subtle);
      }

      /* Animations */
      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .animate-fade-in {
        animation: fade-in 0.5s ease-out forwards;
      }
      
      @keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in-up {
        animation: fade-in-up 0.5s ease-out forwards;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--gold-primary), var(--fire-orange));
        color: white;
      }
      .btn-primary:hover:not(:disabled) {
        box-shadow: 0 8px 24px rgba(212, 175, 55, 0.4);
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { GoogleGenAI } from "@google/genai";
        const { useState, useEffect, useRef, Fragment } = React;

        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        // !!! IMPORTANT: REPLACE THIS WITH YOUR ACTUAL API KEY !!!
        // If you are using this in a live environment, consider a backend proxy to hide this key.
        const API_KEY = "YOUR_API_KEY_HERE"; 

        const MODEL_LITE = 'gemini-flash-lite-latest'; 
        const MODEL_PRO = 'gemini-3-pro-preview';

        // ==========================================
        // DATA & CONSTANTS
        // ==========================================

        const LEVEL_GUIDE_DATA = [
          {
            level: 1,
            title: "What do you want?",
            subtitle: "Describe the specific result or outcome you are chasing.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <linearGradient id="skyGrad" x1="0" y1="0" x2="0" y2="250">
                    <stop offset="0%" stopColor="#0D0D0D" />
                    <stop offset="100%" stopColor="#1A1A1A" />
                  </linearGradient>
                  <linearGradient id="waterGrad" x1="0" y1="250" x2="0" y2="500">
                    <stop offset="0%" stopColor="#1A1A1A" stopOpacity="0.8" />
                    <stop offset="100%" stopColor="#000000" stopOpacity="0.95" />
                  </linearGradient>
                  <linearGradient id="iceLight" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stopColor="#FFFFFF" />
                    <stop offset="100%" stopColor="#D4AF37" />
                  </linearGradient>
                  <linearGradient id="iceDark" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stopColor="#333333" />
                    <stop offset="100%" stopColor="#111111" />
                  </linearGradient>
                  <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur stdDeviation="5" result="blur" />
                    <feComposite in="SourceGraphic" in2="blur" operator="over" />
                  </filter>
                </defs>

                <rect width="800" height="250" fill="url(#skyGrad)" />
                <rect y="250" width="800" height="250" fill="url(#waterGrad)" />
                
                <line x1="0" y1="250" x2="800" y2="250" stroke="#D4AF37" strokeWidth="1" strokeDasharray="4 4" opacity="0.5" />
                <text x="780" y="240" fill="#D4AF37" fontSize="12" fontFamily="monospace" textAnchor="end" opacity="0.8">WATERLINE [VISIBILITY THRESHOLD]</text>

                <g filter="url(#glow)">
                   <path d="M400 100 L460 250 L340 250 Z" fill="url(#iceLight)" stroke="#D4AF37" strokeWidth="2" />
                   <path d="M400 100 L430 250 L460 250 Z" fill="#B8962F" opacity="0.5" />
                </g>

                <path d="M340 250 L300 350 L350 450 L450 480 L500 380 L460 250 Z" fill="url(#iceDark)" stroke="#444" strokeWidth="1" opacity="0.8" />
                
                <path d="M340 250 L350 450" stroke="#333" strokeDasharray="2 2" />
                <path d="M460 250 L450 480" stroke="#333" strokeDasharray="2 2" />
                <path d="M400 250 L400 400" stroke="#D4AF37" strokeWidth="1" opacity="0.3" />

                <g transform="translate(500, 120)">
                    <line x1="0" y1="0" x2="-40" y2="20" stroke="#D4AF37" />
                    <circle cx="0" cy="0" r="3" fill="#D4AF37" />
                    <text x="10" y="4" fill="#FFFFFF" fontSize="14" fontWeight="bold">SYMPTOM</text>
                    <text x="10" y="20" fill="#B0B0B0" fontSize="10" fontFamily="monospace">VISIBLE OUTCOME</text>
                </g>

                <g transform="translate(250, 350)">
                    <line x1="0" y1="0" x2="50" y2="0" stroke="#666" />
                    <circle cx="0" cy="0" r="3" fill="#666" />
                    <text x="-10" y="4" fill="#666" fontSize="14" textAnchor="end">ROOT CAUSE</text>
                    <text x="-10" y="20" fill="#444" fontSize="10" fontFamily="monospace" textAnchor="end">HIDDEN DRIVER</text>
                </g>
              </svg>
            ),
            htmlBody: `
              <h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Tip of the Iceberg</h3>
              <p class='mb-6 text-[#B0B0B0] leading-relaxed'>
                You are solving for the part of the problem you can see. But in complex systems—and human beings are the most complex systems—the visible outcome is just a symptom of a deeper structure.
              </p>
              
              <div class="bg-[#1F1F1F] p-5 rounded border-l-2 border-[#D4AF37] mb-6 shadow-lg">
                <h4 class='text-white font-bold text-sm uppercase tracking-wide mb-2'>The "So That" Test</h4>
                <p class='text-[#B0B0B0] text-sm'>
                   If your goal is generic (e.g., "I want money"), ask yourself "So that... what?" 
                   <br/><br/>
                   <em>"I want money SO THAT I can stop feeling inferior to my brother."</em>
                   <br/>
                   Now we have a real place to start.
                </p>
              </div>
              
              <p class='text-sm text-[#666] italic'>
                Describe the tangible result precisely. The AI needs a clear target to begin the excavation.
              </p>
            `
          },
          {
            level: 2,
            title: "What breaks without this?",
            subtitle: "Identify the mechanical breakdown or direct consequence.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none" xmlns="http://www.w3.org/2000/svg">
                 <defs>
                    <linearGradient id="metal" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0%" stopColor="#444" />
                        <stop offset="50%" stopColor="#777" />
                        <stop offset="100%" stopColor="#333" />
                    </linearGradient>
                    <filter id="shadow">
                        <feDropShadow dx="2" dy="2" stdDeviation="3" floodOpacity="0.5"/>
                    </filter>
                 </defs>

                 <rect width="800" height="500" fill="#0D0D0D" />
                 
                 <path d="M0 50 H800 M0 150 H800 M0 250 H800 M0 350 H800 M0 450 H800" stroke="#222" strokeWidth="1" />
                 <path d="M50 0 V500 M150 0 V500 M250 0 V500 M350 0 V500 M450 0 V500 M550 0 V500 M650 0 V500 M750 0 V500" stroke="#222" strokeWidth="1" />

                 <g transform="translate(200, 250)" filter="url(#shadow)">
                    <circle cx="0" cy="0" r="80" fill="url(#metal)" stroke="#D4AF37" strokeWidth="2" />
                    <circle cx="0" cy="0" r="30" fill="#1A1A1A" />
                    <path d="M-80 0 L-60 0 M80 0 L60 0 M0 -80 L0 -60 M0 80 L0 60" stroke="#111" strokeWidth="4" />
                    <text x="0" y="5" fill="#D4AF37" fontSize="12" textAnchor="middle" fontWeight="bold">ACTION</text>
                 </g>

                 <g transform="translate(350, 250)">
                    <circle cx="0" cy="0" r="60" fill="none" stroke="#666" strokeWidth="1" strokeDasharray="5 5" />
                    <text x="0" y="5" fill="#666" fontSize="10" textAnchor="middle">MISSING LINK</text>
                 </g>
                 
                 <g transform="translate(550, 250)" filter="url(#shadow)">
                    <circle cx="0" cy="0" r="90" fill="#E53E3E" fillOpacity="0.1" stroke="#E53E3E" strokeWidth="2" />
                    <circle cx="0" cy="0" r="20" fill="#E53E3E" />
                    <path d="M0 0 L60 -60" stroke="#E53E3E" strokeWidth="2" />
                     <text x="0" y="40" fill="#E53E3E" fontSize="12" textAnchor="middle" fontWeight="bold">FAILURE</text>
                 </g>

                 <path d="M280 250 L290 250" stroke="#D4AF37" strokeWidth="2" markerEnd="url(#arrow)" />
                 <path d="M410 250 L460 250" stroke="#E53E3E" strokeWidth="2" strokeDasharray="4 2" />
                 
                 <g transform="translate(380, 100)">
                    <rect x="0" y="0" width="140" height="60" rx="4" fill="#1A1A1A" stroke="#E53E3E" />
                    <text x="70" y="25" fill="#E53E3E" fontSize="12" textAnchor="middle" fontWeight="bold">SYSTEM ALERT</text>
                    <text x="70" y="45" fill="#B0B0B0" fontSize="10" textAnchor="middle">PROCESS INTERRUPTED</text>
                    <line x1="70" y1="60" x2="100" y2="150" stroke="#E53E3E" strokeWidth="1" />
                 </g>
              </svg>
            ),
            htmlBody: `
              <h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Logic Chain</h3>
              <p class='mb-6 text-[#B0B0B0] leading-relaxed'>
                Before we get to feelings, we must map the mechanics. Level 2 identifies the <strong>functional breakdown</strong>. It is the "If P, then Q" statement of your problem.
              </p>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                 <div class="bg-[#1A1A1A] p-4 rounded border-t-2 border-[#666]">
                    <strong class="text-white block mb-1">Bad Logic</strong>
                    <p class="text-xs text-[#666]">"If I don't lose weight, I will be sad." (Too early for emotion)</p>
                 </div>
                 <div class="bg-[#1A1A1A] p-4 rounded border-t-2 border-[#D4AF37]">
                    <strong class="text-white block mb-1">Good Logic</strong>
                    <p class="text-xs text-[#B0B0B0]">"If I don't lose weight, I physically cannot go hiking with my kids." (Functional Limit)</p>
                 </div>
              </div>

              <p class='text-sm text-[#E5C76B] font-semibold'>
                What specific activity, opportunity, or state of being becomes impossible?
              </p>
            `
          },
          {
            level: 3,
            title: "What feeling is driving this?",
            subtitle: "Name the raw emotion you are running from or towards.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none" xmlns="http://www.w3.org/2000/svg">
                 <defs>
                    <radialGradient id="coreHeat" cx="0.5" cy="0.5" r="0.5">
                        <stop offset="0%" stopColor="#FF6B35" />
                        <stop offset="60%" stopColor="#E53E3E" />
                        <stop offset="100%" stopColor="#1A1A1A" />
                    </radialGradient>
                 </defs>
                 
                 <rect width="800" height="500" fill="#0D0D0D" />

                 <g transform="translate(400, 250)">
                    <path d="M-200 0 A 200 200 0 1 1 200 0" fill="none" stroke="#444" strokeWidth="40" strokeDasharray="4 2" />
                    <text x="0" y="-230" fill="#666" fontSize="12" textAnchor="middle" letterSpacing="2">LOGIC & REASON</text>
                    
                    <path d="M-140 0 A 140 140 0 1 1 140 0" fill="none" stroke="#666" strokeWidth="30" opacity="0.5" />
                    <text x="0" y="-160" fill="#888" fontSize="12" textAnchor="middle" letterSpacing="2">JUSTIFICATION</text>

                    <circle cx="0" cy="0" r="80" fill="url(#coreHeat)" />
                    <circle cx="0" cy="0" r="60" fill="#FFFFFF" fillOpacity="0.1" />
                    <text x="0" y="5" fill="#FFFFFF" fontSize="16" fontWeight="bold" textAnchor="middle">FEAR</text>
                    <text x="0" y="25" fill="#000" fontSize="10" fontWeight="bold" textAnchor="middle">THE FUEL</text>
                 </g>

                 <g transform="translate(650, 100)">
                    <rect x="0" y="0" width="100" height="150" fill="#1A1A1A" stroke="#333" />
                    <rect x="10" y="10" width="80" height="130" fill="#000" />
                    <rect x="30" y="40" width="40" height="100" fill="#333" />
                    <rect x="30" y="60" width="40" height="80" fill="#E53E3E" />
                    <text x="50" y="130" fill="#FFF" fontSize="10" textAnchor="middle" transform="rotate(-90 50 130)">PRESSURE</text>
                 </g>

                 <line x1="400" y1="250" x2="650" y2="250" stroke="#FF6B35" strokeWidth="2" />
                 <circle cx="650" cy="250" r="4" fill="#FF6B35" />
                 <text x="660" y="255" fill="#FF6B35" fontSize="14" fontWeight="bold">EMOTIONAL DRIVER</text>
              </svg>
            ),
            htmlBody: `
              <h3 class='text-xl font-bold mb-4 text-[#FF6B35]'>The Reactor Core</h3>
              <p class='mb-6 text-[#B0B0B0] leading-relaxed'>
                Logic is the steering wheel, but emotion is the fuel. At Level 3, we stop pretending this is a "business decision" or a "health decision." It is an emotional transaction.
              </p>
              
              <div class="bg-[#1A1A1A] border border-[#FF6B35] p-5 rounded-lg mb-6">
                 <h4 class='text-[#FF6B35] font-bold mb-2 uppercase text-xs tracking-wider'>The 2 Polarities</h4>
                 <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-center text-sm text-gray-400">
                        <span>Moving AWAY from Pain</span>
                        <span class="text-[#E53E3E]">Fear, Shame, Anger</span>
                    </div>
                    <div class="w-full h-1 bg-[#333]"><div class="w-1/2 h-full bg-gradient-to-r from-[#E53E3E] to-[#D4AF37]"></div></div>
                    <div class="flex justify-between items-center text-sm text-gray-400">
                        <span>Moving TOWARD Pleasure</span>
                        <span class="text-[#D4AF37]">Pride, Peace, Glory</span>
                    </div>
                 </div>
              </div>
              
              <p class='text-sm text-[#B0B0B0]'>
                Don't use intellectual words like "Concerned." Use visceral words like "Terrified," "Humiliated," or "Free."
              </p>
            `
          },
          {
            level: 4,
            title: "Who are you becoming?",
            subtitle: "Confront the identity you are building or destroying.",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none" xmlns="http://www.w3.org/2000/svg">
                 <defs>
                    <linearGradient id="gridGrad" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stopColor="#D4AF37" stopOpacity="0.5"/>
                        <stop offset="100%" stopColor="#000" stopOpacity="0"/>
                    </linearGradient>
                 </defs>
                 <rect width="800" height="500" fill="#0D0D0D" />

                 <path d="M0 0 L800 500 M800 0 L0 500" stroke="#222" strokeWidth="0.5" />
                 <rect x="200" y="50" width="400" height="400" stroke="url(#gridGrad)" strokeWidth="1" strokeDasharray="10 10" />

                 <path d="M350 150 Q 300 150 300 250 Q 300 350 350 400 L 350 450 L 500 450 L 500 400 Q 550 350 550 250 Q 550 150 500 150 Z" stroke="#333" strokeWidth="2" fill="none" />
                 
                 <g transform="translate(400, 220)">
                    <rect x="-40" y="-30" width="80" height="60" stroke="#D4AF37" strokeWidth="2" fill="#D4AF37" fillOpacity="0.1" />
                    <line x1="-40" y1="0" x2="40" y2="0" stroke="#D4AF37" strokeWidth="1" />
                    <line x1="0" y1="-30" x2="0" y2="30" stroke="#D4AF37" strokeWidth="1" />
                    <circle cx="0" cy="0" r="5" fill="#D4AF37" />
                 </g>

                 <path d="M520 160 Q 580 160 580 250 Q 580 340 520 440" stroke="#E5C76B" strokeWidth="3" fill="none" filter="url(#glow)" />
                 <text x="600" y="300" fill="#E5C76B" fontSize="14" letterSpacing="2">PERSONA</text>
                 <line x1="580" y1="280" x2="600" y2="295" stroke="#E5C76B" strokeWidth="1" />

                 <text x="320" y="480" fill="#666" fontSize="12" fontFamily="monospace">INTERNAL ARCHITECTURE</text>
                 <text x="400" y="100" fill="#D4AF37" fontSize="18" textAnchor="middle" fontWeight="bold">IDENTITY CONSTRUCT</text>
              </svg>
            ),
            htmlBody: `
              <h3 class='text-xl font-bold mb-4 text-[#E5C76B]'>The Architectural Blueprint</h3>
              <p class='mb-6 text-[#B0B0B0] leading-relaxed'>
                We act in accordance with who we believe we are. Level 4 digs into your <strong>Self-Concept</strong>. Are you a "Victim" trying to be a "Victor"? Are you an "Imposter" trying to be "Real"?
              </p>
              
              <div class="space-y-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-8 h-8 rounded-full bg-[#1A1A1A] border border-[#D4AF37] flex items-center justify-center text-[#D4AF37] font-bold">1</div>
                    <div>
                        <strong class="text-white text-sm block">The Fear Identity</strong>
                        <span class="text-[#666] text-xs">"I am afraid I am becoming lazy/irrelevant/abandoned."</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="w-8 h-8 rounded-full bg-[#1A1A1A] border border-[#FFF] flex items-center justify-center text-white font-bold">2</div>
                    <div>
                        <strong class="text-white text-sm block">The Evidence Trap</strong>
                        <span class="text-[#666] text-xs">"I need this result to PROVE that I am worthy/capable."</span>
                    </div>
                </div>
              </div>
              
              <p class='text-sm text-[#B0B0B0]'>
                Start your sentence with "I am..." or "I am afraid of being..."
              </p>
            `
          },
          {
            level: 5,
            title: "The Origin Point",
            subtitle: "What is the core belief or past wound anchoring all of this?",
            svgContent: (
              <svg className="w-full h-full" viewBox="0 0 800 500" fill="none" xmlns="http://www.w3.org/2000/svg">
                 <defs>
                    <radialGradient id="magma" cx="0.5" cy="1" r="1">
                        <stop offset="0%" stopColor="#D4AF37" />
                        <stop offset="50%" stopColor="#B8962F" />
                        <stop offset="100%" stopColor="#000" />
                    </radialGradient>
                 </defs>
                 <rect width="800" height="500" fill="#0D0D0D" />

                 <path d="M0 100 Q 400 150 800 100 V 500 H 0 Z" fill="#151515" />
                 <path d="M0 250 Q 400 300 800 250 V 500 H 0 Z" fill="#111" />
                 <path d="M0 400 Q 400 450 800 400 V 500 H 0 Z" fill="#0A0A0A" />

                 <path d="M400 100 L 400 450" stroke="#D4AF37" strokeWidth="2" strokeDasharray="2 2" />
                 
                 <g transform="translate(400, 450)">
                    <circle cx="0" cy="0" r="150" fill="url(#magma)" opacity="0.2" filter="url(#glow)" />
                    <circle cx="0" cy="0" r="10" fill="#D4AF37" />
                    <circle cx="0" cy="0" r="20" stroke="#D4AF37" strokeWidth="1" strokeDasharray="4 4" />
                 </g>

                 <text x="400" y="80" fill="#666" fontSize="12" textAnchor="middle">PRESENT DAY REALITY</text>
                 <text x="400" y="480" fill="#D4AF37" fontSize="14" textAnchor="middle" fontWeight="bold" letterSpacing="2">ORIGIN POINT</text>
                 
                 <text x="50" y="150" fill="#333" fontSize="10">5 YEARS AGO</text>
                 <text x="50" y="300" fill="#333" fontSize="10">10 YEARS AGO</text>
                 <text x="50" y="450" fill="#333" fontSize="10">CHILDHOOD</text>

                 <line x1="80" y1="150" x2="720" y2="150" stroke="#333" strokeWidth="1" strokeDasharray="2 2" />
                 <line x1="80" y1="300" x2="720" y2="300" stroke="#333" strokeWidth="1" strokeDasharray="2 2" />
              </svg>
            ),
            htmlBody: `
              <h3 class='text-xl font-bold mb-4 text-[#D4AF37]'>The Bedrock</h3>
              <p class='mb-6 text-[#B0B0B0] leading-relaxed'>
                This is the source code. The root cause is rarely about the future; it is almost always about the past. It is the rule you made for yourself long ago that is now running your life without your permission.
              </p>
              
              <div class="bg-[#1A1A1A] p-6 rounded-lg border border-[#333] mb-6">
                <h4 class='text-white font-bold mb-4 uppercase text-xs tracking-widest'>The 3 Archetypes of Root Cause</h4>
                <ul class="space-y-3">
                    <li class="flex gap-3">
                        <span class="text-[#D4AF37]">✦</span>
                        <div class="text-sm text-[#B0B0B0]"><strong class="text-white">The Vow:</strong> A promise made in pain. "I will never be poor like my dad."</div>
                    </li>
                    <li class="flex gap-3">
                        <span class="text-[#D4AF37]">✦</span>
                        <div class="text-sm text-[#B0B0B0]"><strong class="text-white">The Wound:</strong> An unresolved hurt. "I'm still trying to get picked for the team."</div>
                    </li>
                    <li class="flex gap-3">
                        <span class="text-[#D4AF37]">✦</span>
                        <div class="text-sm text-[#B0B0B0]"><strong class="text-white">The Belief:</strong> A false truth. "If I rest, I am lazy."</div>
                    </li>
                </ul>
              </div>
              
              <p class='text-sm text-[#666] italic'>
                What old story is this goal trying to rewrite?
              </p>
            `
          }
        ];

        // ==========================================
        // SERVICES
        // ==========================================

        const generateNextQuestion = async (history, currentLevel) => {
          try {
            if (API_KEY === "YOUR_API_KEY_HERE" || !API_KEY) {
                console.warn("API Key missing. Returning mock question.");
                return "API Key is missing in the code. Please edit index.html and add your Google Gemini API Key.";
            }

            const ai = new GoogleGenAI({ apiKey: API_KEY });
            
            const historyText = history.map(h => `Level ${h.level} Question: ${h.question}\nLevel ${h.level} Answer: ${h.answer}`).join('\n\n');
            const lastAnswer = history[history.length - 1].answer;
            
            let systemPrompt = "";
            
            if (currentLevel === 2) {
                systemPrompt = `
                ROLE: Expert Socratic Coach.
                TASK: User has provided their Surface Goal (Level 1).
                
                USER'S LEVEL 1 ANSWER: "${lastAnswer}"
                
                YOUR JOB:
                1. Reflect their goal back to them.
                2. Ask specifically WHY they want that result in terms of what it FIXES or ENABLES mechanically.
                3. Do NOT ask about deep emotions yet. Ask about the practical outcome.
                
                STRUCTURE:
                "You want '${lastAnswer}'. Why? What specifically does that result allow you to do that you can't do today?"
                
                OUTPUT: Just the question. No preamble.
                `;
            } else if (currentLevel === 3) {
                systemPrompt = `
                ROLE: Expert Socratic Coach.
                TASK: User has provided the Mechanical Consequence (Level 2).
                
                USER'S LEVEL 2 ANSWER: "${lastAnswer}"
                FULL CONTEXT:
                ${historyText}
                
                YOUR JOB:
                1. Take their Level 2 answer ("${lastAnswer}").
                2. Ask WHY that consequence matters emotionally. 
                3. Dig for the FEELING.
                
                STRUCTURE:
                "You said '${lastAnswer}'. Why does that outcome matter so much to you? What feeling does it give you?"
                
                OUTPUT: Just the question. No preamble.
                `;
            } else if (currentLevel === 4) {
                systemPrompt = `
                ROLE: Expert Socratic Coach.
                TASK: User has provided the Emotional Driver (Level 3).
                
                USER'S LEVEL 3 ANSWER: "${lastAnswer}"
                FULL CONTEXT:
                ${historyText}
                
                YOUR JOB:
                1. Take their Level 3 answer ("${lastAnswer}").
                2. Ask WHY they feel that way—connecting it to their IDENTITY.
                3. Who are they afraid of becoming?
                
                STRUCTURE:
                "If you continue feeling '${lastAnswer}', what does that tell you about who you are becoming? Why is that version of yourself so scary?"
                
                OUTPUT: Just the question. No preamble.
                `;
            } else if (currentLevel === 5) {
                systemPrompt = `
                ROLE: Expert Socratic Coach.
                TASK: User has provided their Identity Fear (Level 4).
                
                USER'S LEVEL 4 ANSWER: "${lastAnswer}"
                FULL CONTEXT:
                ${historyText}
                
                YOUR JOB:
                1. Take their Level 4 answer ("${lastAnswer}").
                2. Ask WHY this identity fear exists. Trace it to the ROOT.
                3. Where did this start?
                
                STRUCTURE:
                "You said you're afraid of being '${lastAnswer}'. Why? When was the first time in your life you felt that specific fear, and who made you feel it?"
                
                OUTPUT: Just the question. No preamble.
                `;
            }

            const response = await ai.models.generateContent({
              model: MODEL_LITE,
              contents: systemPrompt,
            });

            return response.text?.trim() || "Why is that significant to you?";
          } catch (error) {
            console.error("Gemini API Error (Next Question):", error);
            return "Error contacting AI. Please check your API Key and internet connection.";
          }
        };

        const generateSynthesis = async (history) => {
          try {
            if (API_KEY === "YOUR_API_KEY_HERE" || !API_KEY) {
                return {
                    whyStatement: "API Key Missing. Please edit the HTML file to include your Google Gemini API Key.",
                    emotionalCore: "Key Missing"
                };
            }

            const ai = new GoogleGenAI({ apiKey: API_KEY });
            const historyText = history.map(h => `Level ${h.level}: ${h.answer}`).join('\n');

            const prompt = `
            You are a Master Psychologist and Strategic Life Coach.
            Review this "5 Levels of Why" session and generate a powerful insight report.

            SESSION DATA:
            ${historyText}

            TASK:
            1. "Why Statement": Write a 150-word narrative that connects their Level 1 goal directly to their Level 5 root. Show them the hidden thread they didn't see. Use "You" language. Be direct, not fluffy.
            2. "Emotional Core": A single, punchy sentence that summarizes their core driver. It should sound like a personal manifesto or a hard truth.

            OUTPUT JSON:
            {
              "whyStatement": "...",
              "emotionalCore": "..."
            }
            `;

            const response = await ai.models.generateContent({
              model: MODEL_PRO,
              contents: prompt,
              config: {
                responseMimeType: 'application/json'
              }
            });

            const text = response.text || "{}";
            try {
                const json = JSON.parse(text);
                return {
                    whyStatement: json.whyStatement || text,
                    emotionalCore: json.emotionalCore || "Your truth is yours to define."
                };
            } catch (e) {
                return {
                    whyStatement: text,
                    emotionalCore: "Excavation Complete."
                };
            }
          } catch (error) {
            console.error("Gemini API Error (Synthesis):", error);
            return {
              whyStatement: "An error occurred while contacting the AI service.",
              emotionalCore: "Please try again later."
            };
          }
        };

        // ==========================================
        // COMPONENTS
        // ==========================================

        const MobileKnowledgeCard = ({ level }) => {
          const data = LEVEL_GUIDE_DATA[Math.min(Math.max(level, 1), 5) - 1];

          return (
            <div className="bg-[#1A1A1A] border border-[#333] rounded-xl p-5 mb-8 shadow-xl animate-fade-in lg:hidden">
              <div className="mb-4">
                 <span className="inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider border border-[#D4AF37] text-[#D4AF37] bg-[#D4AF37] bg-opacity-10 mb-2">
                    Level {data.level} Guide
                 </span>
                 <h2 className="text-xl font-bold text-white leading-tight">
                    {data.title}
                 </h2>
              </div>
              <div className="w-full aspect-video bg-[#0D0D0D] rounded-lg mb-4 border border-[#333] overflow-hidden relative">
                  <div className="w-full h-full p-2">
                     {data.svgContent}
                  </div>
              </div>
              <div 
                 className="prose prose-invert prose-sm max-w-none prose-p:text-[#B0B0B0] prose-strong:text-white"
                 dangerouslySetInnerHTML= 
              />
            </div>
          );
        };

        const KnowledgePanel = ({ currentLevel }) => {
          const [activeData, setActiveData] = useState(LEVEL_GUIDE_DATA[0]);
          const [animating, setAnimating] = useState(false);

          useEffect(() => {
            setAnimating(true);
            const timeout = setTimeout(() => {
              const levelIndex = Math.min(Math.max(currentLevel, 1), 5) - 1;
              setActiveData(LEVEL_GUIDE_DATA[levelIndex]);
              setAnimating(false);
            }, 300);
            return () => clearTimeout(timeout);
          }, [currentLevel]);

          const progress = (Math.min(currentLevel, 5) / 5) * 100;

          return (
            <div className="h-full flex flex-col bg-[#1A1A1A] shadow-2xl relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-1 bg-[#0D0D0D] z-10">
                <div 
                    className="h-full transition-all duration-1000 ease-out bg-gradient-to-r from-[#D4AF37] to-[#FF6B35]"
                    style=
                ></div>
              </div>

              <div className="flex-1 overflow-y-auto custom-scrollbar p-6 md:p-8">
                <div 
                  className={`transition-all duration-500 ease-in-out transform ${animating ? 'opacity-0 translate-y-4' : 'opacity-100 translate-y-0'}`}
                >
                    <div className="mb-8">
                        <span className="inline-block px-3 py-1 rounded text-xs font-bold uppercase tracking-wider border border-[#D4AF37] text-[#D4AF37] bg-[#D4AF37] bg-opacity-10 mb-3">
                            Level {activeData.level}
                        </span>
                        <h2 className="text-2xl md:text-3xl font-bold text-white leading-tight mb-2">
                            {activeData.title}
                        </h2>
                        <p className="text-[#B0B0B0] text-base md:text-lg font-light tracking-wide">
                            {activeData.subtitle}
                        </p>
                    </div>

                    <div className="w-full aspect-video bg-[#0D0D0D] rounded-xl mb-8 flex items-center justify-center border border-[#333] shadow-inner relative overflow-hidden group">
                        <div className="absolute inset-0 bg-gradient-to-br from-[#D4AF37] to-[#FF6B35] opacity-0 group-hover:opacity-5 transition-opacity duration-700"></div>
                        <div className="w-full h-full p-2 md:p-4 transition-transform duration-700 group-hover:scale-[1.02]">
                            {activeData.svgContent}
                        </div>
                    </div>

                    <div 
                        className="prose prose-invert prose-lg max-w-none prose-headings:font-bold prose-p:text-[#B0B0B0] prose-strong:text-white pb-8"
                        dangerouslySetInnerHTML= 
                    />
                </div>
              </div>
            </div>
          );
        };

        const SynthesisReportView = ({ report, onRestart }) => {
          return (
            <div className="max-w-3xl mx-auto p-4 md:p-8 pb-12 animate-fade-in">
              <div className="bg-[#1A1A1A] rounded-xl shadow-2xl overflow-hidden border border-[#333]">
                <div className="bg-gradient-to-r from-[#D4AF37] to-[#B8962F] p-1">
                    <div className="bg-[#0D0D0D] p-8 text-center">
                        <span className="text-[#D4AF37] uppercase tracking-[0.2em] text-xs font-bold mb-2 block">Excavation Complete</span>
                        <h2 className="text-3xl font-bold text-white mb-1">Your True North</h2>
                    </div>
                </div>
                
                <div className="p-8 md:p-12 space-y-12">
                  <section>
                    <h3 className="text-sm font-bold text-[#6B6B6B] uppercase tracking-widest mb-6 flex items-center">
                        <span className="w-8 h-[1px] bg-[#6B6B6B] mr-3"></span>
                        Your Why Statement
                    </h3>
                    <div className="prose prose-invert prose-lg max-w-none">
                        <p className="text-white text-xl leading-relaxed font-light whitespace-pre-wrap">
                            {report.whyStatement}
                        </p>
                    </div>
                  </section>

                  <section className="relative">
                     <div className="absolute inset-0 bg-gradient-to-r from-[#D4AF37] to-[#FF6B35] opacity-10 blur-xl rounded-full"></div>
                     <div className="relative border border-[#D4AF37] border-opacity-30 bg-[#0D0D0D] p-8 rounded-xl text-center">
                        <h3 className="text-xs font-bold text-[#D4AF37] uppercase tracking-widest mb-4">Emotional Core</h3>
                        <p className="text-2xl md:text-3xl font-serif italic text-white leading-tight">
                            "{report.emotionalCore}"
                        </p>
                     </div>
                  </section>
                </div>
                
                <div className="bg-[#0D0D0D] p-8 border-t border-[#333] flex justify-center">
                    <button 
                        onClick={onRestart}
                        className="text-[#6B6B6B] hover:text-white font-medium px-6 py-3 border border-[#333] hover:border-[#D4AF37] rounded-lg transition-all uppercase tracking-wider text-sm"
                    >
                        Begin New Excavation
                    </button>
                </div>
              </div>
            </div>
          );
        };

        const ChatInterface = ({
          appState,
          setAppState,
          history,
          setHistory,
          currentLevel,
          setCurrentLevel,
          setSynthesisResult,
          initialProblem,
          setInitialProblem,
        }) => {
          const [inputText, setInputText] = useState('');
          const [loading, setLoading] = useState(false);
          const bottomRef = useRef(null);
          const [activeQuestion, setActiveQuestion] = useState("What do you want?");

          useEffect(() => {
            const scrollToBottom = () => {
              if (bottomRef.current) {
                bottomRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
              }
            };
            scrollToBottom();
            const timeoutId = setTimeout(scrollToBottom, 300);
            return () => clearTimeout(timeoutId);
          }, [history, appState, loading, activeQuestion, currentLevel]);

          const handleStart = () => {
            if (!initialProblem.trim()) return;
            
            const l1History = {
                level: 1,
                question: "What do you want?",
                answer: initialProblem
            };
            
            setHistory([l1History]);
            setAppState('ANALYSIS_LOOP');
            setLoading(true);

            generateNextQuestion([l1History], 2).then(nextQ => {
                setActiveQuestion(nextQ);
                setCurrentLevel(2);
                setLoading(false);
            });
          };

          const handleInteraction = async () => {
            if (!inputText.trim()) return;
            
            const answer = inputText;
            setInputText('');
            setLoading(true);

            const newHistoryItem = {
              level: currentLevel,
              question: activeQuestion,
              answer: answer
            };

            const updatedHistory = [...history, newHistoryItem];
            setHistory(updatedHistory);

            if (currentLevel < 5) {
              const nextLevel = currentLevel + 1;
              const nextQ = await generateNextQuestion(updatedHistory, nextLevel);
              setActiveQuestion(nextQ);
              setCurrentLevel(nextLevel);
              setLoading(false);
            } else {
              setAppState('SYNTHESIZING');
              const report = await generateSynthesis(updatedHistory);
              setSynthesisResult(report);
              setAppState('COMPLETE');
              setLoading(false);
            }
          };

          const renderBubble = (text, isUser, index) => (
            <div key={index} className={`flex w-full mb-8 ${isUser ? 'justify-end' : 'justify-start'}`}>
              <div className={`max-w-[90%] md:max-w-[85%] p-6 rounded-2xl shadow-lg overflow-hidden ${
                isUser 
                  ? 'bg-[#2A2A2A] text-white rounded-tr-none border border-[#333]' 
                  : 'bg-[#D4AF37] bg-opacity-10 text-white rounded-tl-none border border-[#D4AF37] border-opacity-30'
              }`}>
                <p className={`whitespace-pre-wrap break-words text-base md:text-lg leading-relaxed ${!isUser && 'font-medium text-[#E5C76B]'}`}>
                    {text}
                </p>
              </div>
            </div>
          );

          return (
            <div className="flex flex-col h-full bg-[#0D0D0D]">
              <div className="flex-1 overflow-y-auto p-4 md:p-8 pb-8 custom-scrollbar">
                <div className="max-w-3xl mx-auto">
                  
                  <div className="mb-8 text-center mt-4 flex flex-col items-center">
                     <img 
                       src="https://theunshakableinvestor.com/wp-content/uploads/2025/05/The-Unshakable-Investor-v5@2x-2-e1749039261263.png" 
                       alt="The Unshakable Investor" 
                       className="h-24 md:h-28 mb-4 object-contain drop-shadow-lg"
                     />
                     <p className="text-[#D4AF37] text-sm md:text-base font-medium tracking-[0.3em] uppercase pl-2">Transformation</p>
                     <p className="text-[#6B6B6B] text-[10px] md:text-xs mt-2 uppercase tracking-widest opacity-60">5 Levels of Why</p>
                  </div>

                  {appState === 'DEFINE_PROBLEM' && (
                    <div className="flex flex-col">
                        <div className="bg-[#1A1A1A] p-6 md:p-8 rounded-xl shadow-2xl border border-[#333] animate-fade-in-up order-1 md:order-2">
                            <label className="block text-sm font-bold text-[#D4AF37] uppercase tracking-wider mb-4">
                                Level 1: The Surface Goal
                            </label>
                            <h3 className="text-xl md:text-2xl text-white font-light mb-6">What is the specific result or change you are chasing?</h3>
                            <textarea
                                value={initialProblem}
                                onChange={(e) => setInitialProblem(e.target.value)}
                                placeholder="I want to make more money... I want to lose weight... I want to quit my job..."
                                className="w-full p-4 bg-[#0D0D0D] border border-[#333] rounded-lg focus:border-[#D4AF37] focus:ring-1 focus:ring-[#D4AF37] outline-none transition-all h-32 md:h-40 text-base md:text-lg text-white placeholder-[#444] resize-none"
                            />
                            <button
                                onClick={handleStart}
                                disabled={!initialProblem.trim()}
                                className="mt-6 w-full btn-primary py-4 px-6 rounded-lg font-bold tracking-wide transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            >
                                BEGIN EXCAVATION <span aria-hidden="true">→</span>
                            </button>
                        </div>

                        <div className="lg:hidden mt-8 order-2 md:order-1">
                            <MobileKnowledgeCard level={1} />
                        </div>
                    </div>
                  )}

                  {(appState === 'ANALYSIS_LOOP' || appState === 'SYNTHESIZING' || appState === 'COMPLETE') && (
                    <div className="space-y-2">
                      {history.length > 0 && renderBubble(history[0].answer, true, 0)}

                      {history.slice(1).map((item, idx) => (
                        <Fragment key={idx + 1}>
                          {renderBubble(item.question, false, (idx * 2) + 1)}
                          {renderBubble(item.answer, true, (idx * 2) + 2)}
                        </Fragment>
                      ))}

                      {appState === 'ANALYSIS_LOOP' && !loading && (
                         <>
                            {renderBubble(activeQuestion, false, 999)}
                            <div className="lg:hidden">
                                <MobileKnowledgeCard level={currentLevel} />
                            </div>
                         </>
                      )}

                      {loading && (
                        <div className="flex justify-start mb-6 animate-pulse">
                          <div className="bg-[#1A1A1A] border border-[#333] p-4 rounded-2xl rounded-tl-none flex items-center gap-3">
                            <div className="flex space-x-1">
                              <div className="w-2 h-2 bg-[#D4AF37] rounded-full animate-bounce" style=0ms></div>
                              <div className="w-2 h-2 bg-[#D4AF37] rounded-full animate-bounce" style=150ms></div>
                              <div className="w-2 h-2 bg-[#D4AF37] rounded-full animate-bounce" style=300ms></div>
                            </div>
                            <span className="text-[#6B6B6B] text-xs uppercase tracking-wide font-semibold">
                              {currentLevel < 5 ? 'Excavating deeper...' : 'Synthesizing final report...'}
                            </span>
                          </div>
                        </div>
                      )}
                      
                      <div ref={bottomRef} className="h-4" />
                    </div>
                  )}
                </div>
              </div>

              {appState === 'ANALYSIS_LOOP' && (
                <div className="flex-none w-full bg-[#1A1A1A] border-t border-[#333] p-4 md:p-6 z-30 shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
                    <div className="max-w-3xl mx-auto flex gap-4">
                        <input
                            type="text"
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleInteraction()}
                            placeholder="Type your honest answer here..."
                            className="flex-1 bg-[#0D0D0D] text-white rounded-lg px-4 py-3 md:px-6 md:py-4 outline-none border border-[#333] focus:border-[#D4AF37] transition-colors text-base md:text-lg shadow-inner"
                            autoFocus
                            disabled={loading}
                        />
                        <button
                            onClick={handleInteraction}
                            disabled={!inputText.trim() || loading}
                            className="bg-[#D4AF37] hover:bg-[#B8962F] text-black rounded-lg px-6 md:px-8 py-3 md:py-4 font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-wide text-sm md:text-base"
                        >
                            Next
                        </button>
                    </div>
                </div>
              )}
            </div>
          );
        };

        const App = () => {
          const [appState, setAppState] = useState('DEFINE_PROBLEM');
          const [currentLevel, setCurrentLevel] = useState(1);
          const [initialProblem, setInitialProblem] = useState("");
          const [history, setHistory] = useState([]);
          const [synthesisResult, setSynthesisResult] = useState(null);

          const handleRestart = () => {
            setAppState('DEFINE_PROBLEM');
            setCurrentLevel(1);
            setInitialProblem("");
            setHistory([]);
            setSynthesisResult(null);
          };

          return (
            <div className="h-screen w-full flex flex-col lg:flex-row bg-[#0D0D0D] overflow-hidden">
              <div className={`
                flex-1 h-full overflow-hidden relative z-10
                ${appState === 'COMPLETE' ? 'w-full' : 'w-full lg:w-1/2'}
              `}>
                {appState === 'COMPLETE' && synthesisResult ? (
                    <div className="h-full overflow-y-auto bg-[#0D0D0D] custom-scrollbar">
                        <SynthesisReportView report={synthesisResult} onRestart={handleRestart} />
                    </div>
                ) : (
                    <ChatInterface
                      appState={appState}
                      setAppState={setAppState}
                      history={history}
                      setHistory={setHistory}
                      currentLevel={currentLevel}
                      setCurrentLevel={setCurrentLevel}
                      setSynthesisResult={setSynthesisResult}
                      initialProblem={initialProblem}
                      setInitialProblem={setInitialProblem}
                    />
                )}
              </div>

              {appState !== 'COMPLETE' && (
                <div className="hidden lg:block h-full w-1/2 z-20 shadow-2xl relative border-l border-[#333]">
                  <KnowledgePanel currentLevel={currentLevel} />
                </div>
              )}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>